"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/query";
exports.ids = ["pages/api/query"];
exports.modules = {

/***/ "@azure/arm-appservice":
/*!****************************************!*\
  !*** external "@azure/arm-appservice" ***!
  \****************************************/
/***/ ((module) => {

module.exports = require("@azure/arm-appservice");

/***/ }),

/***/ "@azure/arm-compute":
/*!*************************************!*\
  !*** external "@azure/arm-compute" ***!
  \*************************************/
/***/ ((module) => {

module.exports = require("@azure/arm-compute");

/***/ }),

/***/ "@azure/arm-costmanagement":
/*!********************************************!*\
  !*** external "@azure/arm-costmanagement" ***!
  \********************************************/
/***/ ((module) => {

module.exports = require("@azure/arm-costmanagement");

/***/ }),

/***/ "@azure/arm-monitor":
/*!*************************************!*\
  !*** external "@azure/arm-monitor" ***!
  \*************************************/
/***/ ((module) => {

module.exports = require("@azure/arm-monitor");

/***/ }),

/***/ "@azure/arm-resourcehealth":
/*!********************************************!*\
  !*** external "@azure/arm-resourcehealth" ***!
  \********************************************/
/***/ ((module) => {

module.exports = require("@azure/arm-resourcehealth");

/***/ }),

/***/ "@azure/arm-resources":
/*!***************************************!*\
  !*** external "@azure/arm-resources" ***!
  \***************************************/
/***/ ((module) => {

module.exports = require("@azure/arm-resources");

/***/ }),

/***/ "@azure/arm-security":
/*!**************************************!*\
  !*** external "@azure/arm-security" ***!
  \**************************************/
/***/ ((module) => {

module.exports = require("@azure/arm-security");

/***/ }),

/***/ "@azure/identity":
/*!**********************************!*\
  !*** external "@azure/identity" ***!
  \**********************************/
/***/ ((module) => {

module.exports = require("@azure/identity");

/***/ }),

/***/ "@azure/monitor-query":
/*!***************************************!*\
  !*** external "@azure/monitor-query" ***!
  \***************************************/
/***/ ((module) => {

module.exports = require("@azure/monitor-query");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "@azure/openai":
/*!********************************!*\
  !*** external "@azure/openai" ***!
  \********************************/
/***/ ((module) => {

module.exports = import("@azure/openai");;

/***/ }),

/***/ "axios":
/*!************************!*\
  !*** external "axios" ***!
  \************************/
/***/ ((module) => {

module.exports = import("axios");;

/***/ }),

/***/ "chart.js/auto":
/*!********************************!*\
  !*** external "chart.js/auto" ***!
  \********************************/
/***/ ((module) => {

module.exports = import("chart.js/auto");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fquery&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cquery.js&middlewareConfigBase64=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fquery&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cquery.js&middlewareConfigBase64=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_query_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\query.js */ \"(api)/./pages/api/query.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_query_js__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_query_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_query_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_query_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/query\",\n        pathname: \"/api/query\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_query_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRnF1ZXJ5JnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlNUNhcGklNUNxdWVyeS5qcyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDTDtBQUMxRDtBQUNtRDtBQUNuRDtBQUNBLGlFQUFlLHdFQUFLLENBQUMsZ0RBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLGdEQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLGdIQUFtQjtBQUNsRDtBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCxxQyIsInNvdXJjZXMiOlsid2VicGFjazovL2F6dXJlLWFpLWluZnJhLWFzc2lzdGFudC8/YzEzNyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXNcXFxcYXBpXFxcXHF1ZXJ5LmpzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsIFwiZGVmYXVsdFwiKTtcbi8vIFJlLWV4cG9ydCBjb25maWcuXG5leHBvcnQgY29uc3QgY29uZmlnID0gaG9pc3QodXNlcmxhbmQsIFwiY29uZmlnXCIpO1xuLy8gQ3JlYXRlIGFuZCBleHBvcnQgdGhlIHJvdXRlIG1vZHVsZSB0aGF0IHdpbGwgYmUgY29uc3VtZWQuXG5leHBvcnQgY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgUGFnZXNBUElSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuUEFHRVNfQVBJLFxuICAgICAgICBwYWdlOiBcIi9hcGkvcXVlcnlcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9xdWVyeVwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fquery&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cquery.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/query.js":
/*!****************************!*\
  !*** ./pages/api/query.js ***!
  \****************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _azure_identity__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @azure/identity */ \"@azure/identity\");\n/* harmony import */ var _azure_identity__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_azure_identity__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _azure_monitor_query__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @azure/monitor-query */ \"@azure/monitor-query\");\n/* harmony import */ var _azure_monitor_query__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_azure_monitor_query__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _azure_arm_compute__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @azure/arm-compute */ \"@azure/arm-compute\");\n/* harmony import */ var _azure_arm_compute__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_azure_arm_compute__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _azure_arm_costmanagement__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @azure/arm-costmanagement */ \"@azure/arm-costmanagement\");\n/* harmony import */ var _azure_arm_costmanagement__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_azure_arm_costmanagement__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var _azure_arm_monitor__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @azure/arm-monitor */ \"@azure/arm-monitor\");\n/* harmony import */ var _azure_arm_monitor__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_azure_arm_monitor__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var _azure_arm_resources__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @azure/arm-resources */ \"@azure/arm-resources\");\n/* harmony import */ var _azure_arm_resources__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_azure_arm_resources__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var _azure_arm_appservice__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @azure/arm-appservice */ \"@azure/arm-appservice\");\n/* harmony import */ var _azure_arm_appservice__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(_azure_arm_appservice__WEBPACK_IMPORTED_MODULE_6__);\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! axios */ \"axios\");\n/* harmony import */ var chart_js_auto__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! chart.js/auto */ \"chart.js/auto\");\n/* harmony import */ var _azure_arm_resourcehealth__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @azure/arm-resourcehealth */ \"@azure/arm-resourcehealth\");\n/* harmony import */ var _azure_arm_resourcehealth__WEBPACK_IMPORTED_MODULE_9___default = /*#__PURE__*/__webpack_require__.n(_azure_arm_resourcehealth__WEBPACK_IMPORTED_MODULE_9__);\n/* harmony import */ var _azure_arm_security__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @azure/arm-security */ \"@azure/arm-security\");\n/* harmony import */ var _azure_arm_security__WEBPACK_IMPORTED_MODULE_10___default = /*#__PURE__*/__webpack_require__.n(_azure_arm_security__WEBPACK_IMPORTED_MODULE_10__);\n/* harmony import */ var _azure_openai__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @azure/openai */ \"@azure/openai\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([axios__WEBPACK_IMPORTED_MODULE_7__, chart_js_auto__WEBPACK_IMPORTED_MODULE_8__, _azure_openai__WEBPACK_IMPORTED_MODULE_11__]);\n([axios__WEBPACK_IMPORTED_MODULE_7__, chart_js_auto__WEBPACK_IMPORTED_MODULE_8__, _azure_openai__WEBPACK_IMPORTED_MODULE_11__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\n\n\n\n\n\n// Initialize the OpenAI Client\nconst endpoint = process.env.AZURE_OPENAI_ENDPOINT;\nconst apiKey = process.env.AZURE_OPENAI_API_KEY;\n// Initialize Azure clients\nlet credential, monitorClient, resourceClient, computeClient, webClient, costClient, logsClient;\nasync function initializeClients() {\n    if (!credential) {\n        credential = new _azure_identity__WEBPACK_IMPORTED_MODULE_0__.DefaultAzureCredential();\n        monitorClient = new _azure_arm_monitor__WEBPACK_IMPORTED_MODULE_4__.MonitorClient(credential, process.env.AZURE_SUBSCRIPTION_ID);\n        resourceClient = new _azure_arm_resources__WEBPACK_IMPORTED_MODULE_5__.ResourceManagementClient(credential, process.env.AZURE_SUBSCRIPTION_ID);\n        computeClient = new _azure_arm_compute__WEBPACK_IMPORTED_MODULE_2__.ComputeManagementClient(credential, process.env.AZURE_SUBSCRIPTION_ID);\n        webClient = new _azure_arm_appservice__WEBPACK_IMPORTED_MODULE_6__.WebSiteManagementClient(credential, process.env.AZURE_SUBSCRIPTION_ID);\n        costClient = new _azure_arm_costmanagement__WEBPACK_IMPORTED_MODULE_3__.CostManagementClient(credential);\n        logsClient = new _azure_monitor_query__WEBPACK_IMPORTED_MODULE_1__.LogsQueryClient(credential);\n    }\n}\nasync function getResourceMetrics(resource, timespan, interval = \"PT1H\") {\n    const supportedTypes = [\n        \"Microsoft.Compute/virtualMachines\",\n        \"Microsoft.Web/sites\"\n    ];\n    if (!supportedTypes.includes(resource.type)) {\n        return null;\n    }\n    try {\n        const metrics = await monitorClient.metrics.list(resource.id, {\n            timespan,\n            interval,\n            metricnames: resource.type === \"Microsoft.Compute/virtualMachines\" ? \"Percentage CPU,Available Memory Bytes\" : \"CpuPercentage,MemoryPercentage\"\n        });\n        if (!metrics.value?.length) return null;\n        // Transform metrics into the expected format\n        const metricsData = {\n            resourceName: resource.name,\n            resourceType: resource.type,\n            metrics: {\n                cpu: {\n                    current: metrics.value.find((m)=>m.name.value === (resource.type === \"Microsoft.Compute/virtualMachines\" ? \"Percentage CPU\" : \"CpuPercentage\"))?.timeseries[0]?.data.slice(-1)[0]?.average || 0,\n                    history: metrics.value.find((m)=>m.name.value === (resource.type === \"Microsoft.Compute/virtualMachines\" ? \"Percentage CPU\" : \"CpuPercentage\"))?.timeseries[0]?.data.map((point)=>point.average || 0) || []\n                },\n                memory: {\n                    current: metrics.value.find((m)=>m.name.value === (resource.type === \"Microsoft.Compute/virtualMachines\" ? \"Available Memory Bytes\" : \"MemoryPercentage\"))?.timeseries[0]?.data.slice(-1)[0]?.average || 0,\n                    history: metrics.value.find((m)=>m.name.value === (resource.type === \"Microsoft.Compute/virtualMachines\" ? \"Available Memory Bytes\" : \"MemoryPercentage\"))?.timeseries[0]?.data.map((point)=>point.average || 0) || []\n                }\n            },\n            timestamps: metrics.value[0]?.timeseries[0]?.data.map((point)=>point.timeStamp) || []\n        };\n        return metricsData;\n    } catch (error) {\n        console.warn(`Could not fetch metrics for ${resource.name}:`, error.message);\n        return null;\n    }\n}\nasync function getResourceCosts(scope) {\n    try {\n        const token = await credential.getToken(\"https://management.azure.com/.default\");\n        const today = new Date();\n        const startDate = new Date(today);\n        startDate.setDate(today.getDate() - 30);\n        const startDateStr = startDate.toISOString().split(\"T\")[0];\n        const endDateStr = today.toISOString().split(\"T\")[0];\n        const response = await axios__WEBPACK_IMPORTED_MODULE_7__[\"default\"].post(`https://management.azure.com${scope}/providers/Microsoft.CostManagement/query`, {\n            type: \"ActualCost\",\n            timeframe: \"Custom\",\n            timePeriod: {\n                from: `${startDateStr}T00:00:00Z`,\n                to: `${endDateStr}T23:59:59Z`\n            },\n            dataset: {\n                granularity: \"None\",\n                aggregation: {\n                    totalCost: {\n                        name: \"Cost\",\n                        function: \"Sum\"\n                    }\n                },\n                grouping: [\n                    {\n                        type: \"Dimension\",\n                        name: \"ServiceName\"\n                    }\n                ]\n            }\n        }, {\n            headers: {\n                Authorization: `Bearer ${token.token}`,\n                \"Content-Type\": \"application/json\"\n            },\n            params: {\n                \"api-version\": \"2023-08-01\"\n            }\n        });\n        // Debug logging\n        console.log(\"Cost API Response:\", JSON.stringify(response.data, null, 2));\n        if (!response.data?.properties?.rows) {\n            console.log(\"No rows found in cost data\");\n            return {\n                rows: [],\n                totalCost: 0,\n                dailyAverage: 0,\n                projectedCost: 0\n            };\n        }\n        const rows = response.data.properties.rows;\n        let total = 0;\n        const processedRows = rows.map((row)=>{\n            const serviceName = String(row[0] || \"Unknown Service\");\n            const cost = parseFloat(row[1] || 0);\n            if (!isNaN(cost)) {\n                total += cost;\n            }\n            return [\n                serviceName,\n                cost\n            ];\n        });\n        const dailyAvg = total / 30;\n        const projected = dailyAvg * 30;\n        return {\n            rows: processedRows,\n            totalCost: total,\n            dailyAverage: dailyAvg,\n            projectedCost: projected\n        };\n    } catch (error) {\n        console.error(\"Error fetching costs:\", error.response?.data || error.message);\n        return {\n            rows: [],\n            totalCost: 0,\n            dailyAverage: 0,\n            projectedCost: 0,\n            error: error.message\n        };\n    }\n}\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        return res.status(405).json({\n            message: \"Method not allowed\"\n        });\n    }\n    try {\n        await initializeClients();\n        const { messages } = req.body;\n        const userMessage = messages[messages.length - 1].content.toLowerCase();\n        let azureData = null;\n        let errorDetails = null;\n        try {\n            // List all resources\n            if (userMessage.includes(\"list\") && userMessage.includes(\"resource\")) {\n                try {\n                    const resources = [];\n                    console.log(\"Fetching resources...\");\n                    // Get all resource groups first\n                    const resourceGroups = [];\n                    for await (const group of resourceClient.resourceGroups.list()){\n                        resourceGroups.push(group.name);\n                    }\n                    console.log(`Found ${resourceGroups.length} resource groups`);\n                    // Get resources from each resource group\n                    for (const groupName of resourceGroups){\n                        try {\n                            for await (const resource of resourceClient.resources.listByResourceGroup(groupName)){\n                                resources.push({\n                                    name: resource.name,\n                                    type: resource.type,\n                                    location: resource.location,\n                                    resourceGroup: groupName,\n                                    id: resource.id,\n                                    tags: resource.tags || {},\n                                    provisioningState: resource.provisioningState,\n                                    createdTime: resource.createdTime\n                                });\n                            }\n                        } catch (groupError) {\n                            console.warn(`Error listing resources in group ${groupName}:`, groupError.message);\n                        }\n                    }\n                    console.log(`Found ${resources.length} total resources`);\n                    // Sort resources by type and name\n                    resources.sort((a, b)=>{\n                        if (a.type === b.type) {\n                            return a.name.localeCompare(b.name);\n                        }\n                        return a.type.localeCompare(b.type);\n                    });\n                    azureData = {\n                        type: \"resources\",\n                        data: resources,\n                        count: resources.length,\n                        resourceGroups: resourceGroups.length\n                    };\n                } catch (resourceError) {\n                    console.error(\"Error listing resources:\", resourceError);\n                    azureData = {\n                        type: \"resources\",\n                        data: [],\n                        count: 0,\n                        error: resourceError.message\n                    };\n                }\n            } else if (userMessage.includes(\"spending\") || userMessage.includes(\"cost\")) {\n                const scope = `/subscriptions/${process.env.AZURE_SUBSCRIPTION_ID}`;\n                const costData = await getResourceCosts(scope);\n                azureData = {\n                    type: \"costs\",\n                    data: {\n                        total: costData.totalCost.toFixed(2),\n                        projected: costData.projectedCost.toFixed(2),\n                        byService: costData.rows.map((row)=>({\n                                name: row[0],\n                                cost: row[1].toFixed(2),\n                                percentage: costData.totalCost > 0 ? (row[1] / costData.totalCost * 100).toFixed(1) : \"0\"\n                            }))\n                    },\n                    error: costData.error\n                };\n            } else if (userMessage.includes(\"cpu\") || userMessage.includes(\"usage\")) {\n                const resourceGroups = [];\n                for await (const group of resourceClient.resourceGroups.list()){\n                    resourceGroups.push(group.name);\n                }\n                const vmsPromises = resourceGroups.map((group)=>computeClient.virtualMachines.list(group).catch((err)=>{\n                        console.warn(`Error listing VMs in group ${group}:`, err.message);\n                        return [];\n                    }));\n                const vmLists = await Promise.all(vmsPromises);\n                const allVMs = vmLists.flat().filter((vm)=>vm && vm.id);\n                if (allVMs.length === 0) {\n                    azureData = {\n                        type: \"metrics\",\n                        data: [],\n                        message: \"No virtual machines found\"\n                    };\n                } else {\n                    const timespan = \"PT24H\";\n                    const metricsPromises = allVMs.map((vm)=>getResourceMetrics({\n                            id: vm.id,\n                            name: vm.name,\n                            type: \"Microsoft.Compute/virtualMachines\"\n                        }, timespan).catch((err)=>{\n                            console.warn(`Error fetching metrics for ${vm.name}:`, err.message);\n                            return null;\n                        }));\n                    const metricsResults = await Promise.all(metricsPromises);\n                    const validMetrics = metricsResults.filter((m)=>m !== null);\n                    azureData = {\n                        type: \"metrics\",\n                        data: validMetrics,\n                        count: validMetrics.length\n                    };\n                }\n            }\n        } catch (dataError) {\n            console.error(\"Error fetching Azure data:\", dataError);\n            errorDetails = dataError.message;\n        }\n        // Always return a valid response structure\n        return res.status(200).json({\n            message: messages[messages.length - 1].content,\n            azureData: azureData || {\n                type: \"error\",\n                error: true,\n                message: errorDetails || \"No data available\"\n            }\n        });\n    } catch (error) {\n        console.error(\"Handler error:\", error);\n        return res.status(500).json({\n            message: \"Error processing request\",\n            error: error.message,\n            azureData: {\n                type: \"error\",\n                error: true,\n                message: error.message\n            }\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvcXVlcnkuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUF3RDtBQUNGO0FBQ007QUFDSTtBQUNkO0FBQ2E7QUFDQTtBQUN0QztBQUNZO0FBQ3lCO0FBQ1Y7QUFDUjtBQUU1QywrQkFBK0I7QUFDL0IsTUFBTVksV0FBV0MsUUFBUUMsR0FBRyxDQUFDQyxxQkFBcUI7QUFDbEQsTUFBTUMsU0FBU0gsUUFBUUMsR0FBRyxDQUFDRyxvQkFBb0I7QUFFL0MsMkJBQTJCO0FBQzNCLElBQUlDLFlBQVlDLGVBQWVDLGdCQUFnQkMsZUFBZUMsV0FBV0MsWUFBWUM7QUFFckYsZUFBZUM7SUFDYixJQUFJLENBQUNQLFlBQVk7UUFDZkEsYUFBYSxJQUFJbEIsbUVBQXNCQTtRQUN2Q21CLGdCQUFnQixJQUFJZiw2REFBYUEsQ0FBQ2MsWUFBWUwsUUFBUUMsR0FBRyxDQUFDWSxxQkFBcUI7UUFDL0VOLGlCQUFpQixJQUFJZiwwRUFBd0JBLENBQUNhLFlBQVlMLFFBQVFDLEdBQUcsQ0FBQ1kscUJBQXFCO1FBQzNGTCxnQkFBZ0IsSUFBSW5CLHVFQUF1QkEsQ0FBQ2dCLFlBQVlMLFFBQVFDLEdBQUcsQ0FBQ1kscUJBQXFCO1FBQ3pGSixZQUFZLElBQUloQiwwRUFBdUJBLENBQUNZLFlBQVlMLFFBQVFDLEdBQUcsQ0FBQ1kscUJBQXFCO1FBQ3JGSCxhQUFhLElBQUlwQiwyRUFBb0JBLENBQUNlO1FBQ3RDTSxhQUFhLElBQUl2QixpRUFBZUEsQ0FBQ2lCO0lBQ25DO0FBQ0Y7QUFFQSxlQUFlUyxtQkFBbUJDLFFBQVEsRUFBRUMsUUFBUSxFQUFFQyxXQUFXLE1BQU07SUFDckUsTUFBTUMsaUJBQWlCO1FBQ3JCO1FBQ0E7S0FDRDtJQUVELElBQUksQ0FBQ0EsZUFBZUMsUUFBUSxDQUFDSixTQUFTSyxJQUFJLEdBQUc7UUFDM0MsT0FBTztJQUNUO0lBRUEsSUFBSTtRQUNGLE1BQU1DLFVBQVUsTUFBTWYsY0FBY2UsT0FBTyxDQUFDQyxJQUFJLENBQzlDUCxTQUFTUSxFQUFFLEVBQ1g7WUFDRVA7WUFDQUM7WUFDQU8sYUFBYVQsU0FBU0ssSUFBSSxLQUFLLHNDQUMzQiwwQ0FDQTtRQUNOO1FBR0YsSUFBSSxDQUFDQyxRQUFRSSxLQUFLLEVBQUVDLFFBQVEsT0FBTztRQUVuQyw2Q0FBNkM7UUFDN0MsTUFBTUMsY0FBYztZQUNsQkMsY0FBY2IsU0FBU2MsSUFBSTtZQUMzQkMsY0FBY2YsU0FBU0ssSUFBSTtZQUMzQkMsU0FBUztnQkFDUFUsS0FBSztvQkFDSEMsU0FBU1gsUUFBUUksS0FBSyxDQUFDUSxJQUFJLENBQUNDLENBQUFBLElBQzFCQSxFQUFFTCxJQUFJLENBQUNKLEtBQUssS0FBTVYsQ0FBQUEsU0FBU0ssSUFBSSxLQUFLLHNDQUNoQyxtQkFDQSxlQUFjLElBQ2pCZSxVQUFVLENBQUMsRUFBRSxFQUFFQyxLQUFLQyxNQUFNLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRUMsV0FBVztvQkFDaERDLFNBQVNsQixRQUFRSSxLQUFLLENBQUNRLElBQUksQ0FBQ0MsQ0FBQUEsSUFDMUJBLEVBQUVMLElBQUksQ0FBQ0osS0FBSyxLQUFNVixDQUFBQSxTQUFTSyxJQUFJLEtBQUssc0NBQ2hDLG1CQUNBLGVBQWMsSUFDakJlLFVBQVUsQ0FBQyxFQUFFLEVBQUVDLEtBQUtJLElBQUlDLENBQUFBLFFBQVNBLE1BQU1ILE9BQU8sSUFBSSxNQUFNLEVBQUU7Z0JBQy9EO2dCQUNBSSxRQUFRO29CQUNOVixTQUFTWCxRQUFRSSxLQUFLLENBQUNRLElBQUksQ0FBQ0MsQ0FBQUEsSUFDMUJBLEVBQUVMLElBQUksQ0FBQ0osS0FBSyxLQUFNVixDQUFBQSxTQUFTSyxJQUFJLEtBQUssc0NBQ2hDLDJCQUNBLGtCQUFpQixJQUNwQmUsVUFBVSxDQUFDLEVBQUUsRUFBRUMsS0FBS0MsTUFBTSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUVDLFdBQVc7b0JBQ2hEQyxTQUFTbEIsUUFBUUksS0FBSyxDQUFDUSxJQUFJLENBQUNDLENBQUFBLElBQzFCQSxFQUFFTCxJQUFJLENBQUNKLEtBQUssS0FBTVYsQ0FBQUEsU0FBU0ssSUFBSSxLQUFLLHNDQUNoQywyQkFDQSxrQkFBaUIsSUFDcEJlLFVBQVUsQ0FBQyxFQUFFLEVBQUVDLEtBQUtJLElBQUlDLENBQUFBLFFBQVNBLE1BQU1ILE9BQU8sSUFBSSxNQUFNLEVBQUU7Z0JBQy9EO1lBQ0Y7WUFDQUssWUFBWXRCLFFBQVFJLEtBQUssQ0FBQyxFQUFFLEVBQUVVLFVBQVUsQ0FBQyxFQUFFLEVBQUVDLEtBQUtJLElBQUlDLENBQUFBLFFBQVNBLE1BQU1HLFNBQVMsS0FBSyxFQUFFO1FBQ3ZGO1FBRUEsT0FBT2pCO0lBQ1QsRUFBRSxPQUFPa0IsT0FBTztRQUNkQyxRQUFRQyxJQUFJLENBQUMsQ0FBQyw0QkFBNEIsRUFBRWhDLFNBQVNjLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRWdCLE1BQU1HLE9BQU87UUFDM0UsT0FBTztJQUNUO0FBQ0Y7QUFFQSxlQUFlQyxpQkFBaUJDLEtBQUs7SUFDbkMsSUFBSTtRQUNGLE1BQU1DLFFBQVEsTUFBTTlDLFdBQVcrQyxRQUFRLENBQUM7UUFFeEMsTUFBTUMsUUFBUSxJQUFJQztRQUNsQixNQUFNQyxZQUFZLElBQUlELEtBQUtEO1FBQzNCRSxVQUFVQyxPQUFPLENBQUNILE1BQU1JLE9BQU8sS0FBSztRQUVwQyxNQUFNQyxlQUFlSCxVQUFVSSxXQUFXLEdBQUdDLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRTtRQUMxRCxNQUFNQyxhQUFhUixNQUFNTSxXQUFXLEdBQUdDLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRTtRQUVwRCxNQUFNRSxXQUFXLE1BQU1wRSxrREFBVSxDQUMvQixDQUFDLDRCQUE0QixFQUFFd0QsTUFBTSx5Q0FBeUMsQ0FBQyxFQUMvRTtZQUNFOUIsTUFBTTtZQUNONEMsV0FBVztZQUNYQyxZQUFZO2dCQUNWQyxNQUFNLENBQUMsRUFBRVIsYUFBYSxVQUFVLENBQUM7Z0JBQ2pDUyxJQUFJLENBQUMsRUFBRU4sV0FBVyxVQUFVLENBQUM7WUFDL0I7WUFDQU8sU0FBUztnQkFDUEMsYUFBYTtnQkFDYkMsYUFBYTtvQkFDWEMsV0FBVzt3QkFDVDFDLE1BQU07d0JBQ04yQyxVQUFVO29CQUNaO2dCQUNGO2dCQUNBQyxVQUFVO29CQUNSO3dCQUNFckQsTUFBTTt3QkFDTlMsTUFBTTtvQkFDUjtpQkFDRDtZQUNIO1FBQ0YsR0FDQTtZQUNFNkMsU0FBUztnQkFDUEMsZUFBZSxDQUFDLE9BQU8sRUFBRXhCLE1BQU1BLEtBQUssQ0FBQyxDQUFDO2dCQUN0QyxnQkFBZ0I7WUFDbEI7WUFDQXlCLFFBQVE7Z0JBQ04sZUFBZTtZQUNqQjtRQUNGO1FBR0YsZ0JBQWdCO1FBQ2hCOUIsUUFBUStCLEdBQUcsQ0FBQyxzQkFBc0JDLEtBQUtDLFNBQVMsQ0FBQ2pCLFNBQVMxQixJQUFJLEVBQUUsTUFBTTtRQUV0RSxJQUFJLENBQUMwQixTQUFTMUIsSUFBSSxFQUFFNEMsWUFBWUMsTUFBTTtZQUNwQ25DLFFBQVErQixHQUFHLENBQUM7WUFDWixPQUFPO2dCQUNMSSxNQUFNLEVBQUU7Z0JBQ1JWLFdBQVc7Z0JBQ1hXLGNBQWM7Z0JBQ2RDLGVBQWU7WUFDakI7UUFDRjtRQUVBLE1BQU1GLE9BQU9uQixTQUFTMUIsSUFBSSxDQUFDNEMsVUFBVSxDQUFDQyxJQUFJO1FBQzFDLElBQUlHLFFBQVE7UUFDWixNQUFNQyxnQkFBZ0JKLEtBQUt6QyxHQUFHLENBQUM4QyxDQUFBQTtZQUM3QixNQUFNQyxjQUFjQyxPQUFPRixHQUFHLENBQUMsRUFBRSxJQUFJO1lBQ3JDLE1BQU1HLE9BQU9DLFdBQVdKLEdBQUcsQ0FBQyxFQUFFLElBQUk7WUFFbEMsSUFBSSxDQUFDSyxNQUFNRixPQUFPO2dCQUNoQkwsU0FBU0s7WUFDWDtZQUVBLE9BQU87Z0JBQUNGO2dCQUFhRTthQUFLO1FBQzVCO1FBRUEsTUFBTUcsV0FBV1IsUUFBUTtRQUN6QixNQUFNUyxZQUFZRCxXQUFXO1FBRTdCLE9BQU87WUFDTFgsTUFBTUk7WUFDTmQsV0FBV2E7WUFDWEYsY0FBY1U7WUFDZFQsZUFBZVU7UUFDakI7SUFDRixFQUFFLE9BQU9oRCxPQUFPO1FBQ2RDLFFBQVFELEtBQUssQ0FBQyx5QkFBeUJBLE1BQU1pQixRQUFRLEVBQUUxQixRQUFRUyxNQUFNRyxPQUFPO1FBQzVFLE9BQU87WUFDTGlDLE1BQU0sRUFBRTtZQUNSVixXQUFXO1lBQ1hXLGNBQWM7WUFDZEMsZUFBZTtZQUNmdEMsT0FBT0EsTUFBTUcsT0FBTztRQUN0QjtJQUNGO0FBQ0Y7QUFFZSxlQUFlOEMsUUFBUUMsR0FBRyxFQUFFQyxHQUFHO0lBQzVDLElBQUlELElBQUlFLE1BQU0sS0FBSyxRQUFRO1FBQ3pCLE9BQU9ELElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRW5ELFNBQVM7UUFBcUI7SUFDOUQ7SUFFQSxJQUFJO1FBQ0YsTUFBTXBDO1FBRU4sTUFBTSxFQUFFd0YsUUFBUSxFQUFFLEdBQUdMLElBQUlNLElBQUk7UUFDN0IsTUFBTUMsY0FBY0YsUUFBUSxDQUFDQSxTQUFTMUUsTUFBTSxHQUFHLEVBQUUsQ0FBQzZFLE9BQU8sQ0FBQ0MsV0FBVztRQUNyRSxJQUFJQyxZQUFZO1FBQ2hCLElBQUlDLGVBQWU7UUFFbkIsSUFBSTtZQUNGLHFCQUFxQjtZQUNyQixJQUFJSixZQUFZbkYsUUFBUSxDQUFDLFdBQVdtRixZQUFZbkYsUUFBUSxDQUFDLGFBQWE7Z0JBQ3BFLElBQUk7b0JBQ0YsTUFBTXdGLFlBQVksRUFBRTtvQkFDcEI3RCxRQUFRK0IsR0FBRyxDQUFDO29CQUVaLGdDQUFnQztvQkFDaEMsTUFBTStCLGlCQUFpQixFQUFFO29CQUN6QixXQUFXLE1BQU1DLFNBQVN0RyxlQUFlcUcsY0FBYyxDQUFDdEYsSUFBSSxHQUFJO3dCQUM5RHNGLGVBQWVFLElBQUksQ0FBQ0QsTUFBTWhGLElBQUk7b0JBQ2hDO29CQUNBaUIsUUFBUStCLEdBQUcsQ0FBQyxDQUFDLE1BQU0sRUFBRStCLGVBQWVsRixNQUFNLENBQUMsZ0JBQWdCLENBQUM7b0JBRTVELHlDQUF5QztvQkFDekMsS0FBSyxNQUFNcUYsYUFBYUgsZUFBZ0I7d0JBQ3RDLElBQUk7NEJBQ0YsV0FBVyxNQUFNN0YsWUFBWVIsZUFBZW9HLFNBQVMsQ0FBQ0ssbUJBQW1CLENBQUNELFdBQVk7Z0NBQ3BGSixVQUFVRyxJQUFJLENBQUM7b0NBQ2JqRixNQUFNZCxTQUFTYyxJQUFJO29DQUNuQlQsTUFBTUwsU0FBU0ssSUFBSTtvQ0FDbkI2RixVQUFVbEcsU0FBU2tHLFFBQVE7b0NBQzNCQyxlQUFlSDtvQ0FDZnhGLElBQUlSLFNBQVNRLEVBQUU7b0NBQ2Y0RixNQUFNcEcsU0FBU29HLElBQUksSUFBSSxDQUFDO29DQUN4QkMsbUJBQW1CckcsU0FBU3FHLGlCQUFpQjtvQ0FDN0NDLGFBQWF0RyxTQUFTc0csV0FBVztnQ0FDbkM7NEJBQ0Y7d0JBQ0YsRUFBRSxPQUFPQyxZQUFZOzRCQUNuQnhFLFFBQVFDLElBQUksQ0FBQyxDQUFDLGlDQUFpQyxFQUFFZ0UsVUFBVSxDQUFDLENBQUMsRUFBRU8sV0FBV3RFLE9BQU87d0JBQ25GO29CQUNGO29CQUVBRixRQUFRK0IsR0FBRyxDQUFDLENBQUMsTUFBTSxFQUFFOEIsVUFBVWpGLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQztvQkFFdkQsa0NBQWtDO29CQUNsQ2lGLFVBQVVZLElBQUksQ0FBQyxDQUFDQyxHQUFHQzt3QkFDakIsSUFBSUQsRUFBRXBHLElBQUksS0FBS3FHLEVBQUVyRyxJQUFJLEVBQUU7NEJBQ3JCLE9BQU9vRyxFQUFFM0YsSUFBSSxDQUFDNkYsYUFBYSxDQUFDRCxFQUFFNUYsSUFBSTt3QkFDcEM7d0JBQ0EsT0FBTzJGLEVBQUVwRyxJQUFJLENBQUNzRyxhQUFhLENBQUNELEVBQUVyRyxJQUFJO29CQUNwQztvQkFFQXFGLFlBQVk7d0JBQ1ZyRixNQUFNO3dCQUNOZ0IsTUFBTXVFO3dCQUNOZ0IsT0FBT2hCLFVBQVVqRixNQUFNO3dCQUN2QmtGLGdCQUFnQkEsZUFBZWxGLE1BQU07b0JBQ3ZDO2dCQUNGLEVBQUUsT0FBT2tHLGVBQWU7b0JBQ3RCOUUsUUFBUUQsS0FBSyxDQUFDLDRCQUE0QitFO29CQUMxQ25CLFlBQVk7d0JBQ1ZyRixNQUFNO3dCQUNOZ0IsTUFBTSxFQUFFO3dCQUNSdUYsT0FBTzt3QkFDUDlFLE9BQU8rRSxjQUFjNUUsT0FBTztvQkFDOUI7Z0JBQ0Y7WUFDRixPQUdLLElBQUlzRCxZQUFZbkYsUUFBUSxDQUFDLGVBQWVtRixZQUFZbkYsUUFBUSxDQUFDLFNBQVM7Z0JBQ3pFLE1BQU0rQixRQUFRLENBQUMsZUFBZSxFQUFFbEQsUUFBUUMsR0FBRyxDQUFDWSxxQkFBcUIsQ0FBQyxDQUFDO2dCQUNuRSxNQUFNZ0gsV0FBVyxNQUFNNUUsaUJBQWlCQztnQkFFeEN1RCxZQUFZO29CQUNWckYsTUFBTTtvQkFDTmdCLE1BQU07d0JBQ0pnRCxPQUFPeUMsU0FBU3RELFNBQVMsQ0FBQ3VELE9BQU8sQ0FBQzt3QkFDbENqQyxXQUFXZ0MsU0FBUzFDLGFBQWEsQ0FBQzJDLE9BQU8sQ0FBQzt3QkFDMUNDLFdBQVdGLFNBQVM1QyxJQUFJLENBQUN6QyxHQUFHLENBQUM4QyxDQUFBQSxNQUFRO2dDQUNuQ3pELE1BQU15RCxHQUFHLENBQUMsRUFBRTtnQ0FDWkcsTUFBTUgsR0FBRyxDQUFDLEVBQUUsQ0FBQ3dDLE9BQU8sQ0FBQztnQ0FDckJFLFlBQVlILFNBQVN0RCxTQUFTLEdBQUcsSUFBSSxDQUFDLEdBQUksQ0FBQyxFQUFFLEdBQUdzRCxTQUFTdEQsU0FBUyxHQUFJLEdBQUUsRUFBR3VELE9BQU8sQ0FBQyxLQUFLOzRCQUMxRjtvQkFDRjtvQkFDQWpGLE9BQU9nRixTQUFTaEYsS0FBSztnQkFDdkI7WUFDRixPQUdLLElBQUl5RCxZQUFZbkYsUUFBUSxDQUFDLFVBQVVtRixZQUFZbkYsUUFBUSxDQUFDLFVBQVU7Z0JBQ3JFLE1BQU15RixpQkFBaUIsRUFBRTtnQkFDekIsV0FBVyxNQUFNQyxTQUFTdEcsZUFBZXFHLGNBQWMsQ0FBQ3RGLElBQUksR0FBSTtvQkFDOURzRixlQUFlRSxJQUFJLENBQUNELE1BQU1oRixJQUFJO2dCQUNoQztnQkFFQSxNQUFNb0csY0FBY3JCLGVBQWVwRSxHQUFHLENBQUNxRSxDQUFBQSxRQUNyQ3JHLGNBQWMwSCxlQUFlLENBQUM1RyxJQUFJLENBQUN1RixPQUFPc0IsS0FBSyxDQUFDQyxDQUFBQTt3QkFDOUN0RixRQUFRQyxJQUFJLENBQUMsQ0FBQywyQkFBMkIsRUFBRThELE1BQU0sQ0FBQyxDQUFDLEVBQUV1QixJQUFJcEYsT0FBTzt3QkFDaEUsT0FBTyxFQUFFO29CQUNYO2dCQUdGLE1BQU1xRixVQUFVLE1BQU1DLFFBQVFDLEdBQUcsQ0FBQ047Z0JBQ2xDLE1BQU1PLFNBQVNILFFBQVFJLElBQUksR0FBR0MsTUFBTSxDQUFDQyxDQUFBQSxLQUFNQSxNQUFNQSxHQUFHcEgsRUFBRTtnQkFFdEQsSUFBSWlILE9BQU85RyxNQUFNLEtBQUssR0FBRztvQkFDdkIrRSxZQUFZO3dCQUNWckYsTUFBTTt3QkFDTmdCLE1BQU0sRUFBRTt3QkFDUlksU0FBUztvQkFDWDtnQkFDRixPQUFPO29CQUNMLE1BQU1oQyxXQUFXO29CQUNqQixNQUFNNEgsa0JBQWtCSixPQUFPaEcsR0FBRyxDQUFDbUcsQ0FBQUEsS0FDakM3SCxtQkFDRTs0QkFDRVMsSUFBSW9ILEdBQUdwSCxFQUFFOzRCQUNUTSxNQUFNOEcsR0FBRzlHLElBQUk7NEJBQ2JULE1BQU07d0JBQ1IsR0FDQUosVUFDQW1ILEtBQUssQ0FBQ0MsQ0FBQUE7NEJBQ050RixRQUFRQyxJQUFJLENBQUMsQ0FBQywyQkFBMkIsRUFBRTRGLEdBQUc5RyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUV1RyxJQUFJcEYsT0FBTzs0QkFDbEUsT0FBTzt3QkFDVDtvQkFHRixNQUFNNkYsaUJBQWlCLE1BQU1QLFFBQVFDLEdBQUcsQ0FBQ0s7b0JBQ3pDLE1BQU1FLGVBQWVELGVBQWVILE1BQU0sQ0FBQ3hHLENBQUFBLElBQUtBLE1BQU07b0JBRXREdUUsWUFBWTt3QkFDVnJGLE1BQU07d0JBQ05nQixNQUFNMEc7d0JBQ05uQixPQUFPbUIsYUFBYXBILE1BQU07b0JBQzVCO2dCQUNGO1lBQ0Y7UUFFRixFQUFFLE9BQU9xSCxXQUFXO1lBQ2xCakcsUUFBUUQsS0FBSyxDQUFDLDhCQUE4QmtHO1lBQzVDckMsZUFBZXFDLFVBQVUvRixPQUFPO1FBQ2xDO1FBRUEsMkNBQTJDO1FBQzNDLE9BQU9nRCxJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQzFCbkQsU0FBU29ELFFBQVEsQ0FBQ0EsU0FBUzFFLE1BQU0sR0FBRyxFQUFFLENBQUM2RSxPQUFPO1lBQzlDRSxXQUFXQSxhQUFhO2dCQUN0QnJGLE1BQU07Z0JBQ055QixPQUFPO2dCQUNQRyxTQUFTMEQsZ0JBQWdCO1lBQzNCO1FBQ0Y7SUFFRixFQUFFLE9BQU83RCxPQUFPO1FBQ2RDLFFBQVFELEtBQUssQ0FBQyxrQkFBa0JBO1FBQ2hDLE9BQU9tRCxJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQzFCbkQsU0FBUztZQUNUSCxPQUFPQSxNQUFNRyxPQUFPO1lBQ3BCeUQsV0FBVztnQkFDVHJGLE1BQU07Z0JBQ055QixPQUFPO2dCQUNQRyxTQUFTSCxNQUFNRyxPQUFPO1lBQ3hCO1FBQ0Y7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYXp1cmUtYWktaW5mcmEtYXNzaXN0YW50Ly4vcGFnZXMvYXBpL3F1ZXJ5LmpzP2M3MTUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGVmYXVsdEF6dXJlQ3JlZGVudGlhbCB9IGZyb20gXCJAYXp1cmUvaWRlbnRpdHlcIlxuaW1wb3J0IHsgTG9nc1F1ZXJ5Q2xpZW50IH0gZnJvbSBcIkBhenVyZS9tb25pdG9yLXF1ZXJ5XCJcbmltcG9ydCB7IENvbXB1dGVNYW5hZ2VtZW50Q2xpZW50IH0gZnJvbSBcIkBhenVyZS9hcm0tY29tcHV0ZVwiXG5pbXBvcnQgeyBDb3N0TWFuYWdlbWVudENsaWVudCB9IGZyb20gXCJAYXp1cmUvYXJtLWNvc3RtYW5hZ2VtZW50XCJcbmltcG9ydCB7IE1vbml0b3JDbGllbnQgfSBmcm9tIFwiQGF6dXJlL2FybS1tb25pdG9yXCJcbmltcG9ydCB7IFJlc291cmNlTWFuYWdlbWVudENsaWVudCB9IGZyb20gXCJAYXp1cmUvYXJtLXJlc291cmNlc1wiXG5pbXBvcnQgeyBXZWJTaXRlTWFuYWdlbWVudENsaWVudCB9IGZyb20gXCJAYXp1cmUvYXJtLWFwcHNlcnZpY2VcIlxuaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJ1xuaW1wb3J0IHsgQ2hhcnQgfSBmcm9tICdjaGFydC5qcy9hdXRvJ1xuaW1wb3J0ICogYXMgYXJtUmVzb3VyY2VIZWFsdGggZnJvbSBcIkBhenVyZS9hcm0tcmVzb3VyY2VoZWFsdGhcIlxuaW1wb3J0IHsgU2VjdXJpdHlDZW50ZXIgfSBmcm9tIFwiQGF6dXJlL2FybS1zZWN1cml0eVwiXG5pbXBvcnQgeyBPcGVuQUlDbGllbnQgfSBmcm9tIFwiQGF6dXJlL29wZW5haVwiXG5cbi8vIEluaXRpYWxpemUgdGhlIE9wZW5BSSBDbGllbnRcbmNvbnN0IGVuZHBvaW50ID0gcHJvY2Vzcy5lbnYuQVpVUkVfT1BFTkFJX0VORFBPSU5UO1xuY29uc3QgYXBpS2V5ID0gcHJvY2Vzcy5lbnYuQVpVUkVfT1BFTkFJX0FQSV9LRVk7XG5cbi8vIEluaXRpYWxpemUgQXp1cmUgY2xpZW50c1xubGV0IGNyZWRlbnRpYWwsIG1vbml0b3JDbGllbnQsIHJlc291cmNlQ2xpZW50LCBjb21wdXRlQ2xpZW50LCB3ZWJDbGllbnQsIGNvc3RDbGllbnQsIGxvZ3NDbGllbnQ7XG5cbmFzeW5jIGZ1bmN0aW9uIGluaXRpYWxpemVDbGllbnRzKCkge1xuICBpZiAoIWNyZWRlbnRpYWwpIHtcbiAgICBjcmVkZW50aWFsID0gbmV3IERlZmF1bHRBenVyZUNyZWRlbnRpYWwoKTtcbiAgICBtb25pdG9yQ2xpZW50ID0gbmV3IE1vbml0b3JDbGllbnQoY3JlZGVudGlhbCwgcHJvY2Vzcy5lbnYuQVpVUkVfU1VCU0NSSVBUSU9OX0lEKTtcbiAgICByZXNvdXJjZUNsaWVudCA9IG5ldyBSZXNvdXJjZU1hbmFnZW1lbnRDbGllbnQoY3JlZGVudGlhbCwgcHJvY2Vzcy5lbnYuQVpVUkVfU1VCU0NSSVBUSU9OX0lEKTtcbiAgICBjb21wdXRlQ2xpZW50ID0gbmV3IENvbXB1dGVNYW5hZ2VtZW50Q2xpZW50KGNyZWRlbnRpYWwsIHByb2Nlc3MuZW52LkFaVVJFX1NVQlNDUklQVElPTl9JRCk7XG4gICAgd2ViQ2xpZW50ID0gbmV3IFdlYlNpdGVNYW5hZ2VtZW50Q2xpZW50KGNyZWRlbnRpYWwsIHByb2Nlc3MuZW52LkFaVVJFX1NVQlNDUklQVElPTl9JRCk7XG4gICAgY29zdENsaWVudCA9IG5ldyBDb3N0TWFuYWdlbWVudENsaWVudChjcmVkZW50aWFsKTtcbiAgICBsb2dzQ2xpZW50ID0gbmV3IExvZ3NRdWVyeUNsaWVudChjcmVkZW50aWFsKTtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRSZXNvdXJjZU1ldHJpY3MocmVzb3VyY2UsIHRpbWVzcGFuLCBpbnRlcnZhbCA9ICdQVDFIJykge1xuICBjb25zdCBzdXBwb3J0ZWRUeXBlcyA9IFtcbiAgICAnTWljcm9zb2Z0LkNvbXB1dGUvdmlydHVhbE1hY2hpbmVzJyxcbiAgICAnTWljcm9zb2Z0LldlYi9zaXRlcydcbiAgXTtcbiAgXG4gIGlmICghc3VwcG9ydGVkVHlwZXMuaW5jbHVkZXMocmVzb3VyY2UudHlwZSkpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgbWV0cmljcyA9IGF3YWl0IG1vbml0b3JDbGllbnQubWV0cmljcy5saXN0KFxuICAgICAgcmVzb3VyY2UuaWQsXG4gICAgICB7XG4gICAgICAgIHRpbWVzcGFuLFxuICAgICAgICBpbnRlcnZhbCxcbiAgICAgICAgbWV0cmljbmFtZXM6IHJlc291cmNlLnR5cGUgPT09ICdNaWNyb3NvZnQuQ29tcHV0ZS92aXJ0dWFsTWFjaGluZXMnIFxuICAgICAgICAgID8gJ1BlcmNlbnRhZ2UgQ1BVLEF2YWlsYWJsZSBNZW1vcnkgQnl0ZXMnIFxuICAgICAgICAgIDogJ0NwdVBlcmNlbnRhZ2UsTWVtb3J5UGVyY2VudGFnZSdcbiAgICAgIH1cbiAgICApO1xuXG4gICAgaWYgKCFtZXRyaWNzLnZhbHVlPy5sZW5ndGgpIHJldHVybiBudWxsO1xuXG4gICAgLy8gVHJhbnNmb3JtIG1ldHJpY3MgaW50byB0aGUgZXhwZWN0ZWQgZm9ybWF0XG4gICAgY29uc3QgbWV0cmljc0RhdGEgPSB7XG4gICAgICByZXNvdXJjZU5hbWU6IHJlc291cmNlLm5hbWUsXG4gICAgICByZXNvdXJjZVR5cGU6IHJlc291cmNlLnR5cGUsXG4gICAgICBtZXRyaWNzOiB7XG4gICAgICAgIGNwdToge1xuICAgICAgICAgIGN1cnJlbnQ6IG1ldHJpY3MudmFsdWUuZmluZChtID0+IFxuICAgICAgICAgICAgbS5uYW1lLnZhbHVlID09PSAocmVzb3VyY2UudHlwZSA9PT0gJ01pY3Jvc29mdC5Db21wdXRlL3ZpcnR1YWxNYWNoaW5lcycgXG4gICAgICAgICAgICAgID8gJ1BlcmNlbnRhZ2UgQ1BVJyBcbiAgICAgICAgICAgICAgOiAnQ3B1UGVyY2VudGFnZScpXG4gICAgICAgICAgKT8udGltZXNlcmllc1swXT8uZGF0YS5zbGljZSgtMSlbMF0/LmF2ZXJhZ2UgfHwgMCxcbiAgICAgICAgICBoaXN0b3J5OiBtZXRyaWNzLnZhbHVlLmZpbmQobSA9PiBcbiAgICAgICAgICAgIG0ubmFtZS52YWx1ZSA9PT0gKHJlc291cmNlLnR5cGUgPT09ICdNaWNyb3NvZnQuQ29tcHV0ZS92aXJ0dWFsTWFjaGluZXMnIFxuICAgICAgICAgICAgICA/ICdQZXJjZW50YWdlIENQVScgXG4gICAgICAgICAgICAgIDogJ0NwdVBlcmNlbnRhZ2UnKVxuICAgICAgICAgICk/LnRpbWVzZXJpZXNbMF0/LmRhdGEubWFwKHBvaW50ID0+IHBvaW50LmF2ZXJhZ2UgfHwgMCkgfHwgW11cbiAgICAgICAgfSxcbiAgICAgICAgbWVtb3J5OiB7XG4gICAgICAgICAgY3VycmVudDogbWV0cmljcy52YWx1ZS5maW5kKG0gPT4gXG4gICAgICAgICAgICBtLm5hbWUudmFsdWUgPT09IChyZXNvdXJjZS50eXBlID09PSAnTWljcm9zb2Z0LkNvbXB1dGUvdmlydHVhbE1hY2hpbmVzJyBcbiAgICAgICAgICAgICAgPyAnQXZhaWxhYmxlIE1lbW9yeSBCeXRlcycgXG4gICAgICAgICAgICAgIDogJ01lbW9yeVBlcmNlbnRhZ2UnKVxuICAgICAgICAgICk/LnRpbWVzZXJpZXNbMF0/LmRhdGEuc2xpY2UoLTEpWzBdPy5hdmVyYWdlIHx8IDAsXG4gICAgICAgICAgaGlzdG9yeTogbWV0cmljcy52YWx1ZS5maW5kKG0gPT4gXG4gICAgICAgICAgICBtLm5hbWUudmFsdWUgPT09IChyZXNvdXJjZS50eXBlID09PSAnTWljcm9zb2Z0LkNvbXB1dGUvdmlydHVhbE1hY2hpbmVzJyBcbiAgICAgICAgICAgICAgPyAnQXZhaWxhYmxlIE1lbW9yeSBCeXRlcycgXG4gICAgICAgICAgICAgIDogJ01lbW9yeVBlcmNlbnRhZ2UnKVxuICAgICAgICAgICk/LnRpbWVzZXJpZXNbMF0/LmRhdGEubWFwKHBvaW50ID0+IHBvaW50LmF2ZXJhZ2UgfHwgMCkgfHwgW11cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHRpbWVzdGFtcHM6IG1ldHJpY3MudmFsdWVbMF0/LnRpbWVzZXJpZXNbMF0/LmRhdGEubWFwKHBvaW50ID0+IHBvaW50LnRpbWVTdGFtcCkgfHwgW11cbiAgICB9O1xuXG4gICAgcmV0dXJuIG1ldHJpY3NEYXRhO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUud2FybihgQ291bGQgbm90IGZldGNoIG1ldHJpY3MgZm9yICR7cmVzb3VyY2UubmFtZX06YCwgZXJyb3IubWVzc2FnZSk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0UmVzb3VyY2VDb3N0cyhzY29wZSkge1xuICB0cnkge1xuICAgIGNvbnN0IHRva2VuID0gYXdhaXQgY3JlZGVudGlhbC5nZXRUb2tlbihcImh0dHBzOi8vbWFuYWdlbWVudC5henVyZS5jb20vLmRlZmF1bHRcIik7XG4gICAgXG4gICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKHRvZGF5KTtcbiAgICBzdGFydERhdGUuc2V0RGF0ZSh0b2RheS5nZXREYXRlKCkgLSAzMCk7XG4gICAgXG4gICAgY29uc3Qgc3RhcnREYXRlU3RyID0gc3RhcnREYXRlLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTtcbiAgICBjb25zdCBlbmREYXRlU3RyID0gdG9kYXkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdO1xuICAgIFxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MucG9zdChcbiAgICAgIGBodHRwczovL21hbmFnZW1lbnQuYXp1cmUuY29tJHtzY29wZX0vcHJvdmlkZXJzL01pY3Jvc29mdC5Db3N0TWFuYWdlbWVudC9xdWVyeWAsXG4gICAgICB7XG4gICAgICAgIHR5cGU6IFwiQWN0dWFsQ29zdFwiLFxuICAgICAgICB0aW1lZnJhbWU6IFwiQ3VzdG9tXCIsXG4gICAgICAgIHRpbWVQZXJpb2Q6IHtcbiAgICAgICAgICBmcm9tOiBgJHtzdGFydERhdGVTdHJ9VDAwOjAwOjAwWmAsXG4gICAgICAgICAgdG86IGAke2VuZERhdGVTdHJ9VDIzOjU5OjU5WmBcbiAgICAgICAgfSxcbiAgICAgICAgZGF0YXNldDoge1xuICAgICAgICAgIGdyYW51bGFyaXR5OiBcIk5vbmVcIixcbiAgICAgICAgICBhZ2dyZWdhdGlvbjoge1xuICAgICAgICAgICAgdG90YWxDb3N0OiB7XG4gICAgICAgICAgICAgIG5hbWU6IFwiQ29zdFwiLFxuICAgICAgICAgICAgICBmdW5jdGlvbjogXCJTdW1cIlxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZ3JvdXBpbmc6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdHlwZTogXCJEaW1lbnNpb25cIixcbiAgICAgICAgICAgICAgbmFtZTogXCJTZXJ2aWNlTmFtZVwiXG4gICAgICAgICAgICB9XG4gICAgICAgICAgXVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VuLnRva2VufWAsXG4gICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICAgICAgfSxcbiAgICAgICAgcGFyYW1zOiB7XG4gICAgICAgICAgXCJhcGktdmVyc2lvblwiOiBcIjIwMjMtMDgtMDFcIlxuICAgICAgICB9XG4gICAgICB9XG4gICAgKTtcblxuICAgIC8vIERlYnVnIGxvZ2dpbmdcbiAgICBjb25zb2xlLmxvZygnQ29zdCBBUEkgUmVzcG9uc2U6JywgSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UuZGF0YSwgbnVsbCwgMikpO1xuXG4gICAgaWYgKCFyZXNwb25zZS5kYXRhPy5wcm9wZXJ0aWVzPy5yb3dzKSB7XG4gICAgICBjb25zb2xlLmxvZygnTm8gcm93cyBmb3VuZCBpbiBjb3N0IGRhdGEnKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJvd3M6IFtdLFxuICAgICAgICB0b3RhbENvc3Q6IDAsXG4gICAgICAgIGRhaWx5QXZlcmFnZTogMCxcbiAgICAgICAgcHJvamVjdGVkQ29zdDogMFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCByb3dzID0gcmVzcG9uc2UuZGF0YS5wcm9wZXJ0aWVzLnJvd3M7XG4gICAgbGV0IHRvdGFsID0gMDtcbiAgICBjb25zdCBwcm9jZXNzZWRSb3dzID0gcm93cy5tYXAocm93ID0+IHtcbiAgICAgIGNvbnN0IHNlcnZpY2VOYW1lID0gU3RyaW5nKHJvd1swXSB8fCBcIlVua25vd24gU2VydmljZVwiKTtcbiAgICAgIGNvbnN0IGNvc3QgPSBwYXJzZUZsb2F0KHJvd1sxXSB8fCAwKTtcbiAgICAgIFxuICAgICAgaWYgKCFpc05hTihjb3N0KSkge1xuICAgICAgICB0b3RhbCArPSBjb3N0O1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4gW3NlcnZpY2VOYW1lLCBjb3N0XTtcbiAgICB9KTtcblxuICAgIGNvbnN0IGRhaWx5QXZnID0gdG90YWwgLyAzMDtcbiAgICBjb25zdCBwcm9qZWN0ZWQgPSBkYWlseUF2ZyAqIDMwO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHJvd3M6IHByb2Nlc3NlZFJvd3MsXG4gICAgICB0b3RhbENvc3Q6IHRvdGFsLFxuICAgICAgZGFpbHlBdmVyYWdlOiBkYWlseUF2ZyxcbiAgICAgIHByb2plY3RlZENvc3Q6IHByb2plY3RlZFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgY29zdHM6JywgZXJyb3IucmVzcG9uc2U/LmRhdGEgfHwgZXJyb3IubWVzc2FnZSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJvd3M6IFtdLFxuICAgICAgdG90YWxDb3N0OiAwLFxuICAgICAgZGFpbHlBdmVyYWdlOiAwLFxuICAgICAgcHJvamVjdGVkQ29zdDogMCxcbiAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlXG4gICAgfTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzKSB7XG4gIGlmIChyZXEubWV0aG9kICE9PSAnUE9TVCcpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDUpLmpzb24oeyBtZXNzYWdlOiAnTWV0aG9kIG5vdCBhbGxvd2VkJyB9KTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgYXdhaXQgaW5pdGlhbGl6ZUNsaWVudHMoKTtcbiAgICBcbiAgICBjb25zdCB7IG1lc3NhZ2VzIH0gPSByZXEuYm9keTtcbiAgICBjb25zdCB1c2VyTWVzc2FnZSA9IG1lc3NhZ2VzW21lc3NhZ2VzLmxlbmd0aCAtIDFdLmNvbnRlbnQudG9Mb3dlckNhc2UoKTtcbiAgICBsZXQgYXp1cmVEYXRhID0gbnVsbDtcbiAgICBsZXQgZXJyb3JEZXRhaWxzID0gbnVsbDtcblxuICAgIHRyeSB7XG4gICAgICAvLyBMaXN0IGFsbCByZXNvdXJjZXNcbiAgICAgIGlmICh1c2VyTWVzc2FnZS5pbmNsdWRlcygnbGlzdCcpICYmIHVzZXJNZXNzYWdlLmluY2x1ZGVzKCdyZXNvdXJjZScpKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgcmVzb3VyY2VzID0gW107XG4gICAgICAgICAgY29uc29sZS5sb2coJ0ZldGNoaW5nIHJlc291cmNlcy4uLicpO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIEdldCBhbGwgcmVzb3VyY2UgZ3JvdXBzIGZpcnN0XG4gICAgICAgICAgY29uc3QgcmVzb3VyY2VHcm91cHMgPSBbXTtcbiAgICAgICAgICBmb3IgYXdhaXQgKGNvbnN0IGdyb3VwIG9mIHJlc291cmNlQ2xpZW50LnJlc291cmNlR3JvdXBzLmxpc3QoKSkge1xuICAgICAgICAgICAgcmVzb3VyY2VHcm91cHMucHVzaChncm91cC5uYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc29sZS5sb2coYEZvdW5kICR7cmVzb3VyY2VHcm91cHMubGVuZ3RofSByZXNvdXJjZSBncm91cHNgKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBHZXQgcmVzb3VyY2VzIGZyb20gZWFjaCByZXNvdXJjZSBncm91cFxuICAgICAgICAgIGZvciAoY29uc3QgZ3JvdXBOYW1lIG9mIHJlc291cmNlR3JvdXBzKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBmb3IgYXdhaXQgKGNvbnN0IHJlc291cmNlIG9mIHJlc291cmNlQ2xpZW50LnJlc291cmNlcy5saXN0QnlSZXNvdXJjZUdyb3VwKGdyb3VwTmFtZSkpIHtcbiAgICAgICAgICAgICAgICByZXNvdXJjZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICBuYW1lOiByZXNvdXJjZS5uYW1lLFxuICAgICAgICAgICAgICAgICAgdHlwZTogcmVzb3VyY2UudHlwZSxcbiAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiByZXNvdXJjZS5sb2NhdGlvbixcbiAgICAgICAgICAgICAgICAgIHJlc291cmNlR3JvdXA6IGdyb3VwTmFtZSxcbiAgICAgICAgICAgICAgICAgIGlkOiByZXNvdXJjZS5pZCxcbiAgICAgICAgICAgICAgICAgIHRhZ3M6IHJlc291cmNlLnRhZ3MgfHwge30sXG4gICAgICAgICAgICAgICAgICBwcm92aXNpb25pbmdTdGF0ZTogcmVzb3VyY2UucHJvdmlzaW9uaW5nU3RhdGUsXG4gICAgICAgICAgICAgICAgICBjcmVhdGVkVGltZTogcmVzb3VyY2UuY3JlYXRlZFRpbWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBjYXRjaCAoZ3JvdXBFcnJvcikge1xuICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYEVycm9yIGxpc3RpbmcgcmVzb3VyY2VzIGluIGdyb3VwICR7Z3JvdXBOYW1lfTpgLCBncm91cEVycm9yLm1lc3NhZ2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICBjb25zb2xlLmxvZyhgRm91bmQgJHtyZXNvdXJjZXMubGVuZ3RofSB0b3RhbCByZXNvdXJjZXNgKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBTb3J0IHJlc291cmNlcyBieSB0eXBlIGFuZCBuYW1lXG4gICAgICAgICAgcmVzb3VyY2VzLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgIGlmIChhLnR5cGUgPT09IGIudHlwZSkge1xuICAgICAgICAgICAgICByZXR1cm4gYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhLnR5cGUubG9jYWxlQ29tcGFyZShiLnR5cGUpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIFxuICAgICAgICAgIGF6dXJlRGF0YSA9IHtcbiAgICAgICAgICAgIHR5cGU6ICdyZXNvdXJjZXMnLFxuICAgICAgICAgICAgZGF0YTogcmVzb3VyY2VzLFxuICAgICAgICAgICAgY291bnQ6IHJlc291cmNlcy5sZW5ndGgsXG4gICAgICAgICAgICByZXNvdXJjZUdyb3VwczogcmVzb3VyY2VHcm91cHMubGVuZ3RoXG4gICAgICAgICAgfTtcbiAgICAgICAgfSBjYXRjaCAocmVzb3VyY2VFcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGxpc3RpbmcgcmVzb3VyY2VzOicsIHJlc291cmNlRXJyb3IpO1xuICAgICAgICAgIGF6dXJlRGF0YSA9IHtcbiAgICAgICAgICAgIHR5cGU6ICdyZXNvdXJjZXMnLFxuICAgICAgICAgICAgZGF0YTogW10sXG4gICAgICAgICAgICBjb3VudDogMCxcbiAgICAgICAgICAgIGVycm9yOiByZXNvdXJjZUVycm9yLm1lc3NhZ2VcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIENvc3QgZGF0YVxuICAgICAgZWxzZSBpZiAodXNlck1lc3NhZ2UuaW5jbHVkZXMoJ3NwZW5kaW5nJykgfHwgdXNlck1lc3NhZ2UuaW5jbHVkZXMoJ2Nvc3QnKSkge1xuICAgICAgICBjb25zdCBzY29wZSA9IGAvc3Vic2NyaXB0aW9ucy8ke3Byb2Nlc3MuZW52LkFaVVJFX1NVQlNDUklQVElPTl9JRH1gO1xuICAgICAgICBjb25zdCBjb3N0RGF0YSA9IGF3YWl0IGdldFJlc291cmNlQ29zdHMoc2NvcGUpO1xuICAgICAgICBcbiAgICAgICAgYXp1cmVEYXRhID0ge1xuICAgICAgICAgIHR5cGU6ICdjb3N0cycsXG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgdG90YWw6IGNvc3REYXRhLnRvdGFsQ29zdC50b0ZpeGVkKDIpLFxuICAgICAgICAgICAgcHJvamVjdGVkOiBjb3N0RGF0YS5wcm9qZWN0ZWRDb3N0LnRvRml4ZWQoMiksXG4gICAgICAgICAgICBieVNlcnZpY2U6IGNvc3REYXRhLnJvd3MubWFwKHJvdyA9PiAoe1xuICAgICAgICAgICAgICBuYW1lOiByb3dbMF0sXG4gICAgICAgICAgICAgIGNvc3Q6IHJvd1sxXS50b0ZpeGVkKDIpLFxuICAgICAgICAgICAgICBwZXJjZW50YWdlOiBjb3N0RGF0YS50b3RhbENvc3QgPiAwID8gKChyb3dbMV0gLyBjb3N0RGF0YS50b3RhbENvc3QpICogMTAwKS50b0ZpeGVkKDEpIDogXCIwXCJcbiAgICAgICAgICAgIH0pKVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZXJyb3I6IGNvc3REYXRhLmVycm9yXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIENQVS9Vc2FnZSBkYXRhXG4gICAgICBlbHNlIGlmICh1c2VyTWVzc2FnZS5pbmNsdWRlcygnY3B1JykgfHwgdXNlck1lc3NhZ2UuaW5jbHVkZXMoJ3VzYWdlJykpIHtcbiAgICAgICAgY29uc3QgcmVzb3VyY2VHcm91cHMgPSBbXTtcbiAgICAgICAgZm9yIGF3YWl0IChjb25zdCBncm91cCBvZiByZXNvdXJjZUNsaWVudC5yZXNvdXJjZUdyb3Vwcy5saXN0KCkpIHtcbiAgICAgICAgICByZXNvdXJjZUdyb3Vwcy5wdXNoKGdyb3VwLm5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zdCB2bXNQcm9taXNlcyA9IHJlc291cmNlR3JvdXBzLm1hcChncm91cCA9PiBcbiAgICAgICAgICBjb21wdXRlQ2xpZW50LnZpcnR1YWxNYWNoaW5lcy5saXN0KGdyb3VwKS5jYXRjaChlcnIgPT4ge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKGBFcnJvciBsaXN0aW5nIFZNcyBpbiBncm91cCAke2dyb3VwfTpgLCBlcnIubWVzc2FnZSk7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHZtTGlzdHMgPSBhd2FpdCBQcm9taXNlLmFsbCh2bXNQcm9taXNlcyk7XG4gICAgICAgIGNvbnN0IGFsbFZNcyA9IHZtTGlzdHMuZmxhdCgpLmZpbHRlcih2bSA9PiB2bSAmJiB2bS5pZCk7XG4gICAgICAgIFxuICAgICAgICBpZiAoYWxsVk1zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIGF6dXJlRGF0YSA9IHtcbiAgICAgICAgICAgIHR5cGU6ICdtZXRyaWNzJyxcbiAgICAgICAgICAgIGRhdGE6IFtdLFxuICAgICAgICAgICAgbWVzc2FnZTogJ05vIHZpcnR1YWwgbWFjaGluZXMgZm91bmQnXG4gICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCB0aW1lc3BhbiA9ICdQVDI0SCc7XG4gICAgICAgICAgY29uc3QgbWV0cmljc1Byb21pc2VzID0gYWxsVk1zLm1hcCh2bSA9PiBcbiAgICAgICAgICAgIGdldFJlc291cmNlTWV0cmljcyhcbiAgICAgICAgICAgICAgeyBcbiAgICAgICAgICAgICAgICBpZDogdm0uaWQsIFxuICAgICAgICAgICAgICAgIG5hbWU6IHZtLm5hbWUsIFxuICAgICAgICAgICAgICAgIHR5cGU6ICdNaWNyb3NvZnQuQ29tcHV0ZS92aXJ0dWFsTWFjaGluZXMnIFxuICAgICAgICAgICAgICB9LCBcbiAgICAgICAgICAgICAgdGltZXNwYW5cbiAgICAgICAgICAgICkuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBFcnJvciBmZXRjaGluZyBtZXRyaWNzIGZvciAke3ZtLm5hbWV9OmAsIGVyci5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICk7XG4gICAgICAgICAgXG4gICAgICAgICAgY29uc3QgbWV0cmljc1Jlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChtZXRyaWNzUHJvbWlzZXMpO1xuICAgICAgICAgIGNvbnN0IHZhbGlkTWV0cmljcyA9IG1ldHJpY3NSZXN1bHRzLmZpbHRlcihtID0+IG0gIT09IG51bGwpO1xuICAgICAgICAgIFxuICAgICAgICAgIGF6dXJlRGF0YSA9IHtcbiAgICAgICAgICAgIHR5cGU6ICdtZXRyaWNzJyxcbiAgICAgICAgICAgIGRhdGE6IHZhbGlkTWV0cmljcyxcbiAgICAgICAgICAgIGNvdW50OiB2YWxpZE1ldHJpY3MubGVuZ3RoXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgfSBjYXRjaCAoZGF0YUVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBBenVyZSBkYXRhOicsIGRhdGFFcnJvcik7XG4gICAgICBlcnJvckRldGFpbHMgPSBkYXRhRXJyb3IubWVzc2FnZTtcbiAgICB9XG5cbiAgICAvLyBBbHdheXMgcmV0dXJuIGEgdmFsaWQgcmVzcG9uc2Ugc3RydWN0dXJlXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcbiAgICAgIG1lc3NhZ2U6IG1lc3NhZ2VzW21lc3NhZ2VzLmxlbmd0aCAtIDFdLmNvbnRlbnQsXG4gICAgICBhenVyZURhdGE6IGF6dXJlRGF0YSB8fCB7IFxuICAgICAgICB0eXBlOiAnZXJyb3InLFxuICAgICAgICBlcnJvcjogdHJ1ZSwgXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yRGV0YWlscyB8fCAnTm8gZGF0YSBhdmFpbGFibGUnXG4gICAgICB9XG4gICAgfSk7XG5cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdIYW5kbGVyIGVycm9yOicsIGVycm9yKTtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBcbiAgICAgIG1lc3NhZ2U6ICdFcnJvciBwcm9jZXNzaW5nIHJlcXVlc3QnLFxuICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXG4gICAgICBhenVyZURhdGE6IHtcbiAgICAgICAgdHlwZTogJ2Vycm9yJyxcbiAgICAgICAgZXJyb3I6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2VcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufSAiXSwibmFtZXMiOlsiRGVmYXVsdEF6dXJlQ3JlZGVudGlhbCIsIkxvZ3NRdWVyeUNsaWVudCIsIkNvbXB1dGVNYW5hZ2VtZW50Q2xpZW50IiwiQ29zdE1hbmFnZW1lbnRDbGllbnQiLCJNb25pdG9yQ2xpZW50IiwiUmVzb3VyY2VNYW5hZ2VtZW50Q2xpZW50IiwiV2ViU2l0ZU1hbmFnZW1lbnRDbGllbnQiLCJheGlvcyIsIkNoYXJ0IiwiYXJtUmVzb3VyY2VIZWFsdGgiLCJTZWN1cml0eUNlbnRlciIsIk9wZW5BSUNsaWVudCIsImVuZHBvaW50IiwicHJvY2VzcyIsImVudiIsIkFaVVJFX09QRU5BSV9FTkRQT0lOVCIsImFwaUtleSIsIkFaVVJFX09QRU5BSV9BUElfS0VZIiwiY3JlZGVudGlhbCIsIm1vbml0b3JDbGllbnQiLCJyZXNvdXJjZUNsaWVudCIsImNvbXB1dGVDbGllbnQiLCJ3ZWJDbGllbnQiLCJjb3N0Q2xpZW50IiwibG9nc0NsaWVudCIsImluaXRpYWxpemVDbGllbnRzIiwiQVpVUkVfU1VCU0NSSVBUSU9OX0lEIiwiZ2V0UmVzb3VyY2VNZXRyaWNzIiwicmVzb3VyY2UiLCJ0aW1lc3BhbiIsImludGVydmFsIiwic3VwcG9ydGVkVHlwZXMiLCJpbmNsdWRlcyIsInR5cGUiLCJtZXRyaWNzIiwibGlzdCIsImlkIiwibWV0cmljbmFtZXMiLCJ2YWx1ZSIsImxlbmd0aCIsIm1ldHJpY3NEYXRhIiwicmVzb3VyY2VOYW1lIiwibmFtZSIsInJlc291cmNlVHlwZSIsImNwdSIsImN1cnJlbnQiLCJmaW5kIiwibSIsInRpbWVzZXJpZXMiLCJkYXRhIiwic2xpY2UiLCJhdmVyYWdlIiwiaGlzdG9yeSIsIm1hcCIsInBvaW50IiwibWVtb3J5IiwidGltZXN0YW1wcyIsInRpbWVTdGFtcCIsImVycm9yIiwiY29uc29sZSIsIndhcm4iLCJtZXNzYWdlIiwiZ2V0UmVzb3VyY2VDb3N0cyIsInNjb3BlIiwidG9rZW4iLCJnZXRUb2tlbiIsInRvZGF5IiwiRGF0ZSIsInN0YXJ0RGF0ZSIsInNldERhdGUiLCJnZXREYXRlIiwic3RhcnREYXRlU3RyIiwidG9JU09TdHJpbmciLCJzcGxpdCIsImVuZERhdGVTdHIiLCJyZXNwb25zZSIsInBvc3QiLCJ0aW1lZnJhbWUiLCJ0aW1lUGVyaW9kIiwiZnJvbSIsInRvIiwiZGF0YXNldCIsImdyYW51bGFyaXR5IiwiYWdncmVnYXRpb24iLCJ0b3RhbENvc3QiLCJmdW5jdGlvbiIsImdyb3VwaW5nIiwiaGVhZGVycyIsIkF1dGhvcml6YXRpb24iLCJwYXJhbXMiLCJsb2ciLCJKU09OIiwic3RyaW5naWZ5IiwicHJvcGVydGllcyIsInJvd3MiLCJkYWlseUF2ZXJhZ2UiLCJwcm9qZWN0ZWRDb3N0IiwidG90YWwiLCJwcm9jZXNzZWRSb3dzIiwicm93Iiwic2VydmljZU5hbWUiLCJTdHJpbmciLCJjb3N0IiwicGFyc2VGbG9hdCIsImlzTmFOIiwiZGFpbHlBdmciLCJwcm9qZWN0ZWQiLCJoYW5kbGVyIiwicmVxIiwicmVzIiwibWV0aG9kIiwic3RhdHVzIiwianNvbiIsIm1lc3NhZ2VzIiwiYm9keSIsInVzZXJNZXNzYWdlIiwiY29udGVudCIsInRvTG93ZXJDYXNlIiwiYXp1cmVEYXRhIiwiZXJyb3JEZXRhaWxzIiwicmVzb3VyY2VzIiwicmVzb3VyY2VHcm91cHMiLCJncm91cCIsInB1c2giLCJncm91cE5hbWUiLCJsaXN0QnlSZXNvdXJjZUdyb3VwIiwibG9jYXRpb24iLCJyZXNvdXJjZUdyb3VwIiwidGFncyIsInByb3Zpc2lvbmluZ1N0YXRlIiwiY3JlYXRlZFRpbWUiLCJncm91cEVycm9yIiwic29ydCIsImEiLCJiIiwibG9jYWxlQ29tcGFyZSIsImNvdW50IiwicmVzb3VyY2VFcnJvciIsImNvc3REYXRhIiwidG9GaXhlZCIsImJ5U2VydmljZSIsInBlcmNlbnRhZ2UiLCJ2bXNQcm9taXNlcyIsInZpcnR1YWxNYWNoaW5lcyIsImNhdGNoIiwiZXJyIiwidm1MaXN0cyIsIlByb21pc2UiLCJhbGwiLCJhbGxWTXMiLCJmbGF0IiwiZmlsdGVyIiwidm0iLCJtZXRyaWNzUHJvbWlzZXMiLCJtZXRyaWNzUmVzdWx0cyIsInZhbGlkTWV0cmljcyIsImRhdGFFcnJvciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/query.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fquery&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cquery.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();