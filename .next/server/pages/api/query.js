"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/query";
exports.ids = ["pages/api/query"];
exports.modules = {

/***/ "@azure/arm-appservice":
/*!****************************************!*\
  !*** external "@azure/arm-appservice" ***!
  \****************************************/
/***/ ((module) => {

module.exports = require("@azure/arm-appservice");

/***/ }),

/***/ "@azure/arm-compute":
/*!*************************************!*\
  !*** external "@azure/arm-compute" ***!
  \*************************************/
/***/ ((module) => {

module.exports = require("@azure/arm-compute");

/***/ }),

/***/ "@azure/arm-costmanagement":
/*!********************************************!*\
  !*** external "@azure/arm-costmanagement" ***!
  \********************************************/
/***/ ((module) => {

module.exports = require("@azure/arm-costmanagement");

/***/ }),

/***/ "@azure/arm-monitor":
/*!*************************************!*\
  !*** external "@azure/arm-monitor" ***!
  \*************************************/
/***/ ((module) => {

module.exports = require("@azure/arm-monitor");

/***/ }),

/***/ "@azure/arm-resources":
/*!***************************************!*\
  !*** external "@azure/arm-resources" ***!
  \***************************************/
/***/ ((module) => {

module.exports = require("@azure/arm-resources");

/***/ }),

/***/ "@azure/monitor-query":
/*!***************************************!*\
  !*** external "@azure/monitor-query" ***!
  \***************************************/
/***/ ((module) => {

module.exports = require("@azure/monitor-query");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "@azure/identity":
/*!**********************************!*\
  !*** external "@azure/identity" ***!
  \**********************************/
/***/ ((module) => {

module.exports = import("@azure/identity");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fquery&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cquery.js&middlewareConfigBase64=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fquery&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cquery.js&middlewareConfigBase64=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_query_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\query.js */ \"(api)/./pages/api/query.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_query_js__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_query_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_query_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_query_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/query\",\n        pathname: \"/api/query\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_query_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRnF1ZXJ5JnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlNUNhcGklNUNxdWVyeS5qcyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDTDtBQUMxRDtBQUNtRDtBQUNuRDtBQUNBLGlFQUFlLHdFQUFLLENBQUMsZ0RBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLGdEQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLGdIQUFtQjtBQUNsRDtBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCxxQyIsInNvdXJjZXMiOlsid2VicGFjazovL2F6dXJlLWFpLWluZnJhLWFzc2lzdGFudC8/YzEzNyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXNcXFxcYXBpXFxcXHF1ZXJ5LmpzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsIFwiZGVmYXVsdFwiKTtcbi8vIFJlLWV4cG9ydCBjb25maWcuXG5leHBvcnQgY29uc3QgY29uZmlnID0gaG9pc3QodXNlcmxhbmQsIFwiY29uZmlnXCIpO1xuLy8gQ3JlYXRlIGFuZCBleHBvcnQgdGhlIHJvdXRlIG1vZHVsZSB0aGF0IHdpbGwgYmUgY29uc3VtZWQuXG5leHBvcnQgY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgUGFnZXNBUElSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuUEFHRVNfQVBJLFxuICAgICAgICBwYWdlOiBcIi9hcGkvcXVlcnlcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9xdWVyeVwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fquery&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cquery.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/query.js":
/*!****************************!*\
  !*** ./pages/api/query.js ***!
  \****************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _azure_identity__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @azure/identity */ \"@azure/identity\");\n/* harmony import */ var _azure_monitor_query__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @azure/monitor-query */ \"@azure/monitor-query\");\n/* harmony import */ var _azure_monitor_query__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_azure_monitor_query__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _azure_arm_compute__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @azure/arm-compute */ \"@azure/arm-compute\");\n/* harmony import */ var _azure_arm_compute__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_azure_arm_compute__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _azure_arm_costmanagement__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @azure/arm-costmanagement */ \"@azure/arm-costmanagement\");\n/* harmony import */ var _azure_arm_costmanagement__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_azure_arm_costmanagement__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var _azure_arm_monitor__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @azure/arm-monitor */ \"@azure/arm-monitor\");\n/* harmony import */ var _azure_arm_monitor__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_azure_arm_monitor__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var _azure_arm_resources__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @azure/arm-resources */ \"@azure/arm-resources\");\n/* harmony import */ var _azure_arm_resources__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_azure_arm_resources__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var _azure_arm_appservice__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @azure/arm-appservice */ \"@azure/arm-appservice\");\n/* harmony import */ var _azure_arm_appservice__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(_azure_arm_appservice__WEBPACK_IMPORTED_MODULE_6__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_azure_identity__WEBPACK_IMPORTED_MODULE_0__]);\n_azure_identity__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n\n\nconst mockAIResponse = (query)=>{\n    const q = query.toLowerCase();\n    if (q.includes(\"cpu usage\")) {\n        return \"The CPU usage of your production VM is currently at 75%\";\n    }\n    if (q.includes(\"alerts\")) {\n        return \"Here are the last 5 critical alerts:\\n- High Memory Usage (VM-PROD1)\\n- Failed Backup (DB-02)\\n- Network Timeout (APP-SVC-3)\\n- SSL Certificate Expiring (WAF-01)\\n- Disk Space Critical (STORAGE-05)\";\n    }\n    if (q.includes(\"cost\")) {\n        return \"Your current month's Azure spending is $12,450, which is 15% higher than last month\";\n    }\n    return \"I understand you're asking about Azure infrastructure. Could you be more specific about what you'd like to know?\";\n};\nconst extractQuery = (query)=>{\n    const q = query.toLowerCase();\n    if (q.includes(\"cost\") || q.includes(\"spending\") || q.includes(\"budget\")) {\n        return {\n            type: \"cost\",\n            action: \"overview\"\n        };\n    }\n    if (q.includes(\"performance\") || q.includes(\"cpu\") || q.includes(\"memory\")) {\n        return {\n            type: \"monitor\",\n            action: \"performance\"\n        };\n    }\n    if (q.includes(\"errors\") || q.includes(\"failures\") || q.includes(\"failed\")) {\n        return {\n            type: \"monitor\",\n            action: \"errors\"\n        };\n    }\n    if (q.includes(\"alert\") || q.includes(\"warning\")) {\n        return {\n            type: \"monitor\",\n            action: \"alerts\"\n        };\n    }\n    const restartMatch = q.match(/restart\\s+(?:vm\\s+)?([^\\s]+)\\s+(?:in|from)\\s+(?:resource group\\s+)?([^\\s]+)/i);\n    if (restartMatch) {\n        return {\n            type: \"vm\",\n            action: \"restart\",\n            vmName: restartMatch[1],\n            resourceGroup: restartMatch[2]\n        };\n    }\n    // App Service scaling\n    const scaleMatch = q.match(/scale\\s+(?:app|service)\\s+([^\\s]+)\\s+(?:to|by)\\s+(\\d+)/i);\n    if (scaleMatch) {\n        return {\n            type: \"appservice\",\n            action: \"scale\",\n            appName: scaleMatch[1],\n            instances: parseInt(scaleMatch[2])\n        };\n    }\n    // Resource listing\n    if (q.includes(\"list\") && q.includes(\"resources\")) {\n        return {\n            type: \"resource\",\n            action: \"list\"\n        };\n    }\n    return null;\n};\nconst getCostOptimizations = (costData)=>{\n    const suggestions = [];\n    const totalCost = costData.reduce((sum, d)=>sum + parseFloat(d.cost), 0);\n    // Find expensive resource groups (>20% of total)\n    costData.forEach((d)=>{\n        const percentage = parseFloat(d.cost) / totalCost * 100;\n        if (percentage > 20) {\n            suggestions.push(`âš ï¸ Resource group \"${d.resourceGroup}\" accounts for ${percentage.toFixed(1)}% of total costs. Consider:\r\nâ€¢ Reviewing unused resources\r\nâ€¢ Implementing auto-shutdown for dev/test VMs\r\nâ€¢ Using reserved instances for predictable workloads`);\n        }\n    });\n    // General suggestions if costs are high\n    if (totalCost > 10000) {\n        suggestions.push(`ðŸ’¡ General cost optimization tips:\r\nâ€¢ Enable Azure Advisor for cost recommendations\r\nâ€¢ Review and delete unused resources\r\nâ€¢ Consider moving to PaaS services where possible\r\nâ€¢ Implement resource tagging for better cost tracking`);\n    }\n    return suggestions.length ? \"\\n\\nOptimization Suggestions:\\n\" + suggestions.join(\"\\n\\n\") : \"\";\n};\nconst getMonitoringData = async (client, action)=>{\n    const timespan = {\n        duration: \"P1D\"\n    };\n    if (action === \"performance\") {\n        const result = await client.queryWorkspace(process.env.AZURE_WORKSPACE_ID, `Perf\r\n      | where TimeGenerated > ago(1h)\r\n      | where ObjectName == \"Processor\" or ObjectName == \"Memory\"\r\n      | summarize avg(CounterValue) by ObjectName, CounterName\r\n      | order by ObjectName asc`, timespan);\n        if (!result.tables?.[0]?.rows?.length) {\n            return \"No performance data available for the last hour.\";\n        }\n        return `ðŸ“Š Last hour's performance metrics:\\n${result.tables[0].rows.map((row)=>`â€¢ ${row[0]} ${row[1]}: ${Math.round(row[2])}%`).join(\"\\n\")}`;\n    }\n    if (action === \"errors\") {\n        const result = await client.queryWorkspace(process.env.AZURE_WORKSPACE_ID, `AzureActivity \r\n      | where TimeGenerated > ago(24h)\r\n      | where Level == \"Error\" or Status contains \"Failed\"\r\n      | project TimeGenerated, ResourceGroup, OperationName, Status\r\n      | top 5 by TimeGenerated desc`, timespan);\n        if (!result.tables?.[0]?.rows?.length) {\n            return \"âœ… No errors found in the last 24 hours!\";\n        }\n        return `âš ï¸ Recent errors:\\n${result.tables[0].rows.map((row)=>`â€¢ ${new Date(row[0]).toLocaleString()}: ${row[2]} in ${row[1]} (${row[3]})`).join(\"\\n\")}`;\n    }\n};\nconst getAlertData = async (client)=>{\n    const alerts = await client.activityLogAlerts.listBySubscriptionId();\n    const activeAlerts = [];\n    for await (const alert of alerts){\n        if (alert.enabled) {\n            activeAlerts.push({\n                name: alert.name,\n                description: alert.description,\n                condition: alert.condition?.allOf?.[0]?.equals || \"Custom condition\",\n                severity: alert.severity || \"Unknown\",\n                status: alert.status || \"Active\"\n            });\n        }\n    }\n    if (!activeAlerts.length) {\n        return \"âœ… No active alerts configured.\";\n    }\n    return `ðŸš¨ Active Alert Rules:\\n${activeAlerts.map((alert)=>`â€¢ ${alert.name} (${alert.severity})\\n  ${alert.description || \"No description\"}`).join(\"\\n\\n\")}`;\n};\nconst handleResourceAction = async (action)=>{\n    const credential = new _azure_identity__WEBPACK_IMPORTED_MODULE_0__.DefaultAzureCredential();\n    const client = new _azure_arm_resources__WEBPACK_IMPORTED_MODULE_5__.ResourceManagementClient(credential, process.env.AZURE_SUBSCRIPTION_ID);\n    const resources = await client.resources.list();\n    const groupedResources = {};\n    for await (const resource of resources){\n        const type = resource.type.split(\"/\").pop();\n        if (!groupedResources[type]) {\n            groupedResources[type] = [];\n        }\n        groupedResources[type].push(resource.name);\n    }\n    return `ðŸ“Š Azure Resources:\\n${Object.entries(groupedResources).map(([type, names])=>`\\n${type} (${names.length}):\\n${names.map((name)=>`â€¢ ${name}`).join(\"\\n\")}`).join(\"\\n\")}`;\n};\nconst handleAppServiceAction = async (action)=>{\n    const credential = new _azure_identity__WEBPACK_IMPORTED_MODULE_0__.DefaultAzureCredential();\n    const client = new _azure_arm_appservice__WEBPACK_IMPORTED_MODULE_6__.WebSiteManagementClient(credential, process.env.AZURE_SUBSCRIPTION_ID);\n    if (action.action === \"scale\") {\n        const sites = await client.webApps.list();\n        const app = Array.from(sites).find((s)=>s.name.toLowerCase() === action.appName.toLowerCase());\n        if (!app) {\n            return `âŒ App \"${action.appName}\" not found`;\n        }\n        await client.webApps.updateConfiguration(app.resourceGroup, app.name, {\n            numberOfWorkers: action.instances\n        });\n        return `âœ… Scaled ${action.appName} to ${action.instances} instances`;\n    }\n};\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        return res.status(405).json({\n            reply: \"Method not allowed\"\n        });\n    }\n    const { query } = req.body;\n    if (!query?.trim()) {\n        return res.status(400).json({\n            reply: \"Query is required\"\n        });\n    }\n    try {\n        const credential = new _azure_identity__WEBPACK_IMPORTED_MODULE_0__.DefaultAzureCredential();\n        const action = extractQuery(query);\n        if (action) {\n            switch(action.type){\n                case \"resource\":\n                    return res.status(200).json({\n                        reply: await handleResourceAction(action)\n                    });\n                case \"appservice\":\n                    return res.status(200).json({\n                        reply: await handleAppServiceAction(action)\n                    });\n                case \"monitor\":\n                    {\n                        const logsClient = new _azure_monitor_query__WEBPACK_IMPORTED_MODULE_1__.LogsQueryClient(credential);\n                        if (action.action === \"alerts\") {\n                            const monitorClient = new _azure_arm_monitor__WEBPACK_IMPORTED_MODULE_4__.MonitorClient(credential, process.env.AZURE_SUBSCRIPTION_ID);\n                            const alertData = await getAlertData(monitorClient);\n                            return res.status(200).json({\n                                reply: alertData\n                            });\n                        }\n                        const monitorData = await getMonitoringData(logsClient, action.action);\n                        return res.status(200).json({\n                            reply: monitorData\n                        });\n                    }\n                case \"cost\":\n                    {\n                        const costClient = new _azure_arm_costmanagement__WEBPACK_IMPORTED_MODULE_3__.CostManagementClient(credential, process.env.AZURE_SUBSCRIPTION_ID);\n                        const today = new Date();\n                        const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);\n                        const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);\n                        const costQuery = {\n                            type: \"ActualCost\",\n                            timeframe: \"Custom\",\n                            timePeriod: {\n                                from: firstDay.toISOString(),\n                                to: lastDay.toISOString()\n                            },\n                            dataset: {\n                                granularity: \"Monthly\",\n                                aggregation: {\n                                    totalCost: {\n                                        name: \"Cost\",\n                                        function: \"Sum\"\n                                    }\n                                },\n                                grouping: [\n                                    {\n                                        type: \"Dimension\",\n                                        name: \"ResourceGroup\"\n                                    }\n                                ]\n                            }\n                        };\n                        const scope = `/subscriptions/${process.env.AZURE_SUBSCRIPTION_ID}`;\n                        const result = await costClient.query.usage(scope, costQuery);\n                        const costData = result.rows.map((row)=>({\n                                resourceGroup: row[1],\n                                cost: row[0].toFixed(2)\n                            }));\n                        const total = costData.reduce((sum, d)=>sum + parseFloat(d.cost), 0);\n                        const optimizations = getCostOptimizations(costData);\n                        return res.status(200).json({\n                            reply: `ðŸ’° Current month's costs:\\n${costData.map((d)=>`â€¢ ${d.resourceGroup}: $${d.cost}`).join(\"\\n\")}\\n\\nðŸ“Š Total: $${total.toFixed(2)}${optimizations}`\n                        });\n                    }\n                case \"vm\":\n                    {\n                        const computeClient = new _azure_arm_compute__WEBPACK_IMPORTED_MODULE_2__.ComputeManagementClient(credential, process.env.AZURE_SUBSCRIPTION_ID);\n                        await computeClient.virtualMachines.beginRestartAndWait(action.resourceGroup, action.vmName);\n                        return res.status(200).json({\n                            reply: `âœ… Successfully restarted VM ${action.vmName} in ${action.resourceGroup}`\n                        });\n                    }\n            }\n        }\n        // Default query for failed activities\n        const logsClient = new _azure_monitor_query__WEBPACK_IMPORTED_MODULE_1__.LogsQueryClient(credential);\n        const result = await logsClient.queryWorkspace(process.env.AZURE_WORKSPACE_ID, `AzureActivity \r\n      | where ActivityStatus == 'Failed' \r\n      | project TimeGenerated, ResourceGroup, ResourceProviderValue, OperationName, Properties\r\n      | top 5 by TimeGenerated desc`, {\n            duration: \"P1D\"\n        });\n        if (result.tables?.[0]?.rows?.length > 0) {\n            const formattedResults = result.tables[0].rows.map((row)=>({\n                    time: new Date(row[0]).toLocaleString(),\n                    resourceGroup: row[1],\n                    provider: row[2],\n                    operation: row[3],\n                    details: row[4]\n                }));\n            res.status(200).json({\n                reply: \"Recent failed activities:\\n\" + formattedResults.map((r)=>`â€¢ ${r.time}: ${r.operation} in ${r.resourceGroup}`).join(\"\\n\")\n            });\n        } else {\n            res.status(200).json({\n                reply: \"Good news! No failed activities found in the last 24 hours.\"\n            });\n        }\n    } catch (error) {\n        console.error(\"Azure Error:\", error);\n        res.status(500).json({\n            reply: \"Sorry, I encountered an error while processing your request. Please try again.\"\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvcXVlcnkuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBd0Q7QUFDRjtBQUNNO0FBQ0k7QUFDZDtBQUNhO0FBQ0E7QUFFL0QsTUFBTU8saUJBQWlCLENBQUNDO0lBQ3RCLE1BQU1DLElBQUlELE1BQU1FLFdBQVc7SUFDM0IsSUFBSUQsRUFBRUUsUUFBUSxDQUFDLGNBQWM7UUFDM0IsT0FBTztJQUNUO0lBQ0EsSUFBSUYsRUFBRUUsUUFBUSxDQUFDLFdBQVc7UUFDeEIsT0FBTztJQUNUO0lBQ0EsSUFBSUYsRUFBRUUsUUFBUSxDQUFDLFNBQVM7UUFDdEIsT0FBTztJQUNUO0lBQ0EsT0FBTztBQUNUO0FBRUEsTUFBTUMsZUFBZSxDQUFDSjtJQUNwQixNQUFNQyxJQUFJRCxNQUFNRSxXQUFXO0lBRTNCLElBQUlELEVBQUVFLFFBQVEsQ0FBQyxXQUFXRixFQUFFRSxRQUFRLENBQUMsZUFBZUYsRUFBRUUsUUFBUSxDQUFDLFdBQVc7UUFDeEUsT0FBTztZQUFFRSxNQUFNO1lBQVFDLFFBQVE7UUFBVztJQUM1QztJQUVBLElBQUlMLEVBQUVFLFFBQVEsQ0FBQyxrQkFBa0JGLEVBQUVFLFFBQVEsQ0FBQyxVQUFVRixFQUFFRSxRQUFRLENBQUMsV0FBVztRQUMxRSxPQUFPO1lBQUVFLE1BQU07WUFBV0MsUUFBUTtRQUFjO0lBQ2xEO0lBRUEsSUFBSUwsRUFBRUUsUUFBUSxDQUFDLGFBQWFGLEVBQUVFLFFBQVEsQ0FBQyxlQUFlRixFQUFFRSxRQUFRLENBQUMsV0FBVztRQUMxRSxPQUFPO1lBQUVFLE1BQU07WUFBV0MsUUFBUTtRQUFTO0lBQzdDO0lBRUEsSUFBSUwsRUFBRUUsUUFBUSxDQUFDLFlBQVlGLEVBQUVFLFFBQVEsQ0FBQyxZQUFZO1FBQ2hELE9BQU87WUFBRUUsTUFBTTtZQUFXQyxRQUFRO1FBQVM7SUFDN0M7SUFFQSxNQUFNQyxlQUFlTixFQUFFTyxLQUFLLENBQUM7SUFDN0IsSUFBSUQsY0FBYztRQUNoQixPQUFPO1lBQ0xGLE1BQU07WUFDTkMsUUFBUTtZQUNSRyxRQUFRRixZQUFZLENBQUMsRUFBRTtZQUN2QkcsZUFBZUgsWUFBWSxDQUFDLEVBQUU7UUFDaEM7SUFDRjtJQUVBLHNCQUFzQjtJQUN0QixNQUFNSSxhQUFhVixFQUFFTyxLQUFLLENBQUM7SUFDM0IsSUFBSUcsWUFBWTtRQUNkLE9BQU87WUFDTE4sTUFBTTtZQUNOQyxRQUFRO1lBQ1JNLFNBQVNELFVBQVUsQ0FBQyxFQUFFO1lBQ3RCRSxXQUFXQyxTQUFTSCxVQUFVLENBQUMsRUFBRTtRQUNuQztJQUNGO0lBRUEsbUJBQW1CO0lBQ25CLElBQUlWLEVBQUVFLFFBQVEsQ0FBQyxXQUFXRixFQUFFRSxRQUFRLENBQUMsY0FBYztRQUNqRCxPQUFPO1lBQUVFLE1BQU07WUFBWUMsUUFBUTtRQUFPO0lBQzVDO0lBRUEsT0FBTztBQUNUO0FBRUEsTUFBTVMsdUJBQXVCLENBQUNDO0lBQzVCLE1BQU1DLGNBQWMsRUFBRTtJQUN0QixNQUFNQyxZQUFZRixTQUFTRyxNQUFNLENBQUMsQ0FBQ0MsS0FBS0MsSUFBTUQsTUFBTUUsV0FBV0QsRUFBRUUsSUFBSSxHQUFHO0lBRXhFLGlEQUFpRDtJQUNqRFAsU0FBU1EsT0FBTyxDQUFDSCxDQUFBQTtRQUNmLE1BQU1JLGFBQWEsV0FBWUosRUFBRUUsSUFBSSxJQUFJTCxZQUFhO1FBQ3RELElBQUlPLGFBQWEsSUFBSTtZQUNuQlIsWUFBWVMsSUFBSSxDQUNkLENBQUMsbUJBQW1CLEVBQUVMLEVBQUVYLGFBQWEsQ0FBQyxlQUFlLEVBQUVlLFdBQVdFLE9BQU8sQ0FBQyxHQUFHOzs7b0RBR2pDLENBQUM7UUFFakQ7SUFDRjtJQUVBLHdDQUF3QztJQUN4QyxJQUFJVCxZQUFZLE9BQU87UUFDckJELFlBQVlTLElBQUksQ0FDZCxDQUFDOzs7O3FEQUk4QyxDQUFDO0lBRXBEO0lBRUEsT0FBT1QsWUFBWVcsTUFBTSxHQUFHLG9DQUFvQ1gsWUFBWVksSUFBSSxDQUFDLFVBQVU7QUFDN0Y7QUFFQSxNQUFNQyxvQkFBb0IsT0FBT0MsUUFBUXpCO0lBQ3ZDLE1BQU0wQixXQUFXO1FBQUVDLFVBQVU7SUFBTTtJQUVuQyxJQUFJM0IsV0FBVyxlQUFlO1FBQzVCLE1BQU00QixTQUFTLE1BQU1ILE9BQU9JLGNBQWMsQ0FDeENDLFFBQVFDLEdBQUcsQ0FBQ0Msa0JBQWtCLEVBQzlCLENBQUM7Ozs7K0JBSXdCLENBQUMsRUFDMUJOO1FBR0YsSUFBSSxDQUFDRSxPQUFPSyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUVDLE1BQU1aLFFBQVE7WUFDckMsT0FBTztRQUNUO1FBRUEsT0FBTyxDQUFDLHFDQUFxQyxFQUMzQ00sT0FBT0ssTUFBTSxDQUFDLEVBQUUsQ0FBQ0MsSUFBSSxDQUFDQyxHQUFHLENBQUNDLENBQUFBLE1BQ3hCLENBQUMsRUFBRSxFQUFFQSxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRUEsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUVDLEtBQUtDLEtBQUssQ0FBQ0YsR0FBRyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFDL0NiLElBQUksQ0FBQyxNQUNSLENBQUM7SUFDSjtJQUVBLElBQUl2QixXQUFXLFVBQVU7UUFDdkIsTUFBTTRCLFNBQVMsTUFBTUgsT0FBT0ksY0FBYyxDQUN4Q0MsUUFBUUMsR0FBRyxDQUFDQyxrQkFBa0IsRUFDOUIsQ0FBQzs7OzttQ0FJNEIsQ0FBQyxFQUM5Qk47UUFHRixJQUFJLENBQUNFLE9BQU9LLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRUMsTUFBTVosUUFBUTtZQUNyQyxPQUFPO1FBQ1Q7UUFFQSxPQUFPLENBQUMsbUJBQW1CLEVBQ3pCTSxPQUFPSyxNQUFNLENBQUMsRUFBRSxDQUFDQyxJQUFJLENBQUNDLEdBQUcsQ0FBQ0MsQ0FBQUEsTUFDeEIsQ0FBQyxFQUFFLEVBQUUsSUFBSUcsS0FBS0gsR0FBRyxDQUFDLEVBQUUsRUFBRUksY0FBYyxHQUFHLEVBQUUsRUFBRUosR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLEVBQUVBLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFQSxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUM1RWIsSUFBSSxDQUFDLE1BQ1IsQ0FBQztJQUNKO0FBQ0Y7QUFFQSxNQUFNa0IsZUFBZSxPQUFPaEI7SUFDMUIsTUFBTWlCLFNBQVMsTUFBTWpCLE9BQU9rQixpQkFBaUIsQ0FBQ0Msb0JBQW9CO0lBQ2xFLE1BQU1DLGVBQWUsRUFBRTtJQUV2QixXQUFXLE1BQU1DLFNBQVNKLE9BQVE7UUFDaEMsSUFBSUksTUFBTUMsT0FBTyxFQUFFO1lBQ2pCRixhQUFhekIsSUFBSSxDQUFDO2dCQUNoQjRCLE1BQU1GLE1BQU1FLElBQUk7Z0JBQ2hCQyxhQUFhSCxNQUFNRyxXQUFXO2dCQUM5QkMsV0FBV0osTUFBTUksU0FBUyxFQUFFQyxPQUFPLENBQUMsRUFBRSxFQUFFQyxVQUFVO2dCQUNsREMsVUFBVVAsTUFBTU8sUUFBUSxJQUFJO2dCQUM1QkMsUUFBUVIsTUFBTVEsTUFBTSxJQUFJO1lBQzFCO1FBQ0Y7SUFDRjtJQUVBLElBQUksQ0FBQ1QsYUFBYXZCLE1BQU0sRUFBRTtRQUN4QixPQUFPO0lBQ1Q7SUFFQSxPQUFPLENBQUMsd0JBQXdCLEVBQzlCdUIsYUFBYVYsR0FBRyxDQUFDVyxDQUFBQSxRQUNmLENBQUMsRUFBRSxFQUFFQSxNQUFNRSxJQUFJLENBQUMsRUFBRSxFQUFFRixNQUFNTyxRQUFRLENBQUMsS0FBSyxFQUFFUCxNQUFNRyxXQUFXLElBQUksaUJBQWlCLENBQUMsRUFDakYxQixJQUFJLENBQUMsUUFDUixDQUFDO0FBQ0o7QUFFQSxNQUFNZ0MsdUJBQXVCLE9BQU92RDtJQUNsQyxNQUFNd0QsYUFBYSxJQUFJdEUsbUVBQXNCQTtJQUM3QyxNQUFNdUMsU0FBUyxJQUFJbEMsMEVBQXdCQSxDQUFDaUUsWUFBWTFCLFFBQVFDLEdBQUcsQ0FBQzBCLHFCQUFxQjtJQUN6RixNQUFNQyxZQUFZLE1BQU1qQyxPQUFPaUMsU0FBUyxDQUFDQyxJQUFJO0lBQzdDLE1BQU1DLG1CQUFtQixDQUFDO0lBRTFCLFdBQVcsTUFBTUMsWUFBWUgsVUFBVztRQUN0QyxNQUFNM0QsT0FBTzhELFNBQVM5RCxJQUFJLENBQUMrRCxLQUFLLENBQUMsS0FBS0MsR0FBRztRQUN6QyxJQUFJLENBQUNILGdCQUFnQixDQUFDN0QsS0FBSyxFQUFFO1lBQzNCNkQsZ0JBQWdCLENBQUM3RCxLQUFLLEdBQUcsRUFBRTtRQUM3QjtRQUNBNkQsZ0JBQWdCLENBQUM3RCxLQUFLLENBQUNxQixJQUFJLENBQUN5QyxTQUFTYixJQUFJO0lBQzNDO0lBRUEsT0FBTyxDQUFDLHFCQUFxQixFQUMzQmdCLE9BQU9DLE9BQU8sQ0FBQ0wsa0JBQ1p6QixHQUFHLENBQUMsQ0FBQyxDQUFDcEMsTUFBTW1FLE1BQU0sR0FDakIsQ0FBQyxFQUFFLEVBQUVuRSxLQUFLLEVBQUUsRUFBRW1FLE1BQU01QyxNQUFNLENBQUMsSUFBSSxFQUM3QjRDLE1BQU0vQixHQUFHLENBQUNhLENBQUFBLE9BQVEsQ0FBQyxFQUFFLEVBQUVBLEtBQUssQ0FBQyxFQUFFekIsSUFBSSxDQUFDLE1BQ3JDLENBQUMsRUFDRkEsSUFBSSxDQUFDLE1BQ1YsQ0FBQztBQUNKO0FBRUEsTUFBTTRDLHlCQUF5QixPQUFPbkU7SUFDcEMsTUFBTXdELGFBQWEsSUFBSXRFLG1FQUFzQkE7SUFDN0MsTUFBTXVDLFNBQVMsSUFBSWpDLDBFQUF1QkEsQ0FBQ2dFLFlBQVkxQixRQUFRQyxHQUFHLENBQUMwQixxQkFBcUI7SUFFeEYsSUFBSXpELE9BQU9BLE1BQU0sS0FBSyxTQUFTO1FBQzdCLE1BQU1vRSxRQUFRLE1BQU0zQyxPQUFPNEMsT0FBTyxDQUFDVixJQUFJO1FBQ3ZDLE1BQU1XLE1BQU1DLE1BQU1DLElBQUksQ0FBQ0osT0FBT0ssSUFBSSxDQUFDQyxDQUFBQSxJQUNqQ0EsRUFBRTFCLElBQUksQ0FBQ3BELFdBQVcsT0FBT0ksT0FBT00sT0FBTyxDQUFDVixXQUFXO1FBR3JELElBQUksQ0FBQzBFLEtBQUs7WUFDUixPQUFPLENBQUMsT0FBTyxFQUFFdEUsT0FBT00sT0FBTyxDQUFDLFdBQVcsQ0FBQztRQUM5QztRQUVBLE1BQU1tQixPQUFPNEMsT0FBTyxDQUFDTSxtQkFBbUIsQ0FDdENMLElBQUlsRSxhQUFhLEVBQ2pCa0UsSUFBSXRCLElBQUksRUFDUjtZQUNFNEIsaUJBQWlCNUUsT0FBT08sU0FBUztRQUNuQztRQUdGLE9BQU8sQ0FBQyxTQUFTLEVBQUVQLE9BQU9NLE9BQU8sQ0FBQyxJQUFJLEVBQUVOLE9BQU9PLFNBQVMsQ0FBQyxVQUFVLENBQUM7SUFDdEU7QUFDRjtBQUVlLGVBQWVzRSxRQUFRQyxHQUFHLEVBQUVDLEdBQUc7SUFDNUMsSUFBSUQsSUFBSUUsTUFBTSxLQUFLLFFBQVE7UUFDekIsT0FBT0QsSUFBSXpCLE1BQU0sQ0FBQyxLQUFLMkIsSUFBSSxDQUFDO1lBQUVDLE9BQU87UUFBcUI7SUFDNUQ7SUFFQSxNQUFNLEVBQUV4RixLQUFLLEVBQUUsR0FBR29GLElBQUlLLElBQUk7SUFDMUIsSUFBSSxDQUFDekYsT0FBTzBGLFFBQVE7UUFDbEIsT0FBT0wsSUFBSXpCLE1BQU0sQ0FBQyxLQUFLMkIsSUFBSSxDQUFDO1lBQUVDLE9BQU87UUFBb0I7SUFDM0Q7SUFFQSxJQUFJO1FBQ0YsTUFBTTFCLGFBQWEsSUFBSXRFLG1FQUFzQkE7UUFDN0MsTUFBTWMsU0FBU0YsYUFBYUo7UUFFNUIsSUFBSU0sUUFBUTtZQUNWLE9BQVFBLE9BQU9ELElBQUk7Z0JBQ2pCLEtBQUs7b0JBQ0gsT0FBT2dGLElBQUl6QixNQUFNLENBQUMsS0FBSzJCLElBQUksQ0FBQzt3QkFDMUJDLE9BQU8sTUFBTTNCLHFCQUFxQnZEO29CQUNwQztnQkFFRixLQUFLO29CQUNILE9BQU8rRSxJQUFJekIsTUFBTSxDQUFDLEtBQUsyQixJQUFJLENBQUM7d0JBQzFCQyxPQUFPLE1BQU1mLHVCQUF1Qm5FO29CQUN0QztnQkFFRixLQUFLO29CQUFXO3dCQUNkLE1BQU1xRixhQUFhLElBQUlsRyxpRUFBZUEsQ0FBQ3FFO3dCQUV2QyxJQUFJeEQsT0FBT0EsTUFBTSxLQUFLLFVBQVU7NEJBQzlCLE1BQU1zRixnQkFBZ0IsSUFBSWhHLDZEQUFhQSxDQUFDa0UsWUFBWTFCLFFBQVFDLEdBQUcsQ0FBQzBCLHFCQUFxQjs0QkFDckYsTUFBTThCLFlBQVksTUFBTTlDLGFBQWE2Qzs0QkFDckMsT0FBT1AsSUFBSXpCLE1BQU0sQ0FBQyxLQUFLMkIsSUFBSSxDQUFDO2dDQUFFQyxPQUFPSzs0QkFBVTt3QkFDakQ7d0JBRUEsTUFBTUMsY0FBYyxNQUFNaEUsa0JBQWtCNkQsWUFBWXJGLE9BQU9BLE1BQU07d0JBQ3JFLE9BQU8rRSxJQUFJekIsTUFBTSxDQUFDLEtBQUsyQixJQUFJLENBQUM7NEJBQUVDLE9BQU9NO3dCQUFZO29CQUNuRDtnQkFFQSxLQUFLO29CQUFRO3dCQUNYLE1BQU1DLGFBQWEsSUFBSXBHLDJFQUFvQkEsQ0FBQ21FLFlBQVkxQixRQUFRQyxHQUFHLENBQUMwQixxQkFBcUI7d0JBQ3pGLE1BQU1pQyxRQUFRLElBQUluRDt3QkFDbEIsTUFBTW9ELFdBQVcsSUFBSXBELEtBQUttRCxNQUFNRSxXQUFXLElBQUlGLE1BQU1HLFFBQVEsSUFBSTt3QkFDakUsTUFBTUMsVUFBVSxJQUFJdkQsS0FBS21ELE1BQU1FLFdBQVcsSUFBSUYsTUFBTUcsUUFBUSxLQUFLLEdBQUc7d0JBRXBFLE1BQU1FLFlBQVk7NEJBQ2hCaEcsTUFBTTs0QkFDTmlHLFdBQVc7NEJBQ1hDLFlBQVk7Z0NBQ1Z6QixNQUFNbUIsU0FBU08sV0FBVztnQ0FDMUJDLElBQUlMLFFBQVFJLFdBQVc7NEJBQ3pCOzRCQUNBRSxTQUFTO2dDQUNQQyxhQUFhO2dDQUNiQyxhQUFhO29DQUNYMUYsV0FBVzt3Q0FBRW9DLE1BQU07d0NBQVF1RCxVQUFVO29DQUFNO2dDQUM3QztnQ0FDQUMsVUFBVTtvQ0FDUjt3Q0FBRXpHLE1BQU07d0NBQWFpRCxNQUFNO29DQUFnQjtpQ0FDNUM7NEJBQ0g7d0JBQ0Y7d0JBRUEsTUFBTXlELFFBQVEsQ0FBQyxlQUFlLEVBQUUzRSxRQUFRQyxHQUFHLENBQUMwQixxQkFBcUIsQ0FBQyxDQUFDO3dCQUNuRSxNQUFNN0IsU0FBUyxNQUFNNkQsV0FBVy9GLEtBQUssQ0FBQ2dILEtBQUssQ0FBQ0QsT0FBT1Y7d0JBRW5ELE1BQU1yRixXQUFXa0IsT0FBT00sSUFBSSxDQUFDQyxHQUFHLENBQUNDLENBQUFBLE1BQVE7Z0NBQ3ZDaEMsZUFBZWdDLEdBQUcsQ0FBQyxFQUFFO2dDQUNyQm5CLE1BQU1tQixHQUFHLENBQUMsRUFBRSxDQUFDZixPQUFPLENBQUM7NEJBQ3ZCO3dCQUVBLE1BQU1zRixRQUFRakcsU0FBU0csTUFBTSxDQUFDLENBQUNDLEtBQUtDLElBQU1ELE1BQU1FLFdBQVdELEVBQUVFLElBQUksR0FBRzt3QkFDcEUsTUFBTTJGLGdCQUFnQm5HLHFCQUFxQkM7d0JBRTNDLE9BQU9xRSxJQUFJekIsTUFBTSxDQUFDLEtBQUsyQixJQUFJLENBQUM7NEJBQzFCQyxPQUFPLENBQUMsMkJBQTJCLEVBQ2pDeEUsU0FBU3lCLEdBQUcsQ0FBQ3BCLENBQUFBLElBQUssQ0FBQyxFQUFFLEVBQUVBLEVBQUVYLGFBQWEsQ0FBQyxHQUFHLEVBQUVXLEVBQUVFLElBQUksQ0FBQyxDQUFDLEVBQUVNLElBQUksQ0FBQyxNQUM1RCxlQUFlLEVBQUVvRixNQUFNdEYsT0FBTyxDQUFDLEdBQUcsRUFBRXVGLGNBQWMsQ0FBQzt3QkFDdEQ7b0JBQ0Y7Z0JBRUEsS0FBSztvQkFBTTt3QkFDVCxNQUFNQyxnQkFBZ0IsSUFBSXpILHVFQUF1QkEsQ0FDL0NvRSxZQUNBMUIsUUFBUUMsR0FBRyxDQUFDMEIscUJBQXFCO3dCQUduQyxNQUFNb0QsY0FBY0MsZUFBZSxDQUFDQyxtQkFBbUIsQ0FDckQvRyxPQUFPSSxhQUFhLEVBQ3BCSixPQUFPRyxNQUFNO3dCQUdmLE9BQU80RSxJQUFJekIsTUFBTSxDQUFDLEtBQUsyQixJQUFJLENBQUM7NEJBQzFCQyxPQUFPLENBQUMsNEJBQTRCLEVBQUVsRixPQUFPRyxNQUFNLENBQUMsSUFBSSxFQUFFSCxPQUFPSSxhQUFhLENBQUMsQ0FBQzt3QkFDbEY7b0JBQ0Y7WUFDRjtRQUNGO1FBRUEsc0NBQXNDO1FBQ3RDLE1BQU1pRixhQUFhLElBQUlsRyxpRUFBZUEsQ0FBQ3FFO1FBQ3ZDLE1BQU01QixTQUFTLE1BQU15RCxXQUFXeEQsY0FBYyxDQUM1Q0MsUUFBUUMsR0FBRyxDQUFDQyxrQkFBa0IsRUFDOUIsQ0FBQzs7O21DQUc0QixDQUFDLEVBQzlCO1lBQUVMLFVBQVU7UUFBTTtRQUdwQixJQUFJQyxPQUFPSyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUVDLE1BQU1aLFNBQVMsR0FBRztZQUN4QyxNQUFNMEYsbUJBQW1CcEYsT0FBT0ssTUFBTSxDQUFDLEVBQUUsQ0FBQ0MsSUFBSSxDQUFDQyxHQUFHLENBQUNDLENBQUFBLE1BQVE7b0JBQ3pENkUsTUFBTSxJQUFJMUUsS0FBS0gsR0FBRyxDQUFDLEVBQUUsRUFBRUksY0FBYztvQkFDckNwQyxlQUFlZ0MsR0FBRyxDQUFDLEVBQUU7b0JBQ3JCOEUsVUFBVTlFLEdBQUcsQ0FBQyxFQUFFO29CQUNoQitFLFdBQVcvRSxHQUFHLENBQUMsRUFBRTtvQkFDakJnRixTQUFTaEYsR0FBRyxDQUFDLEVBQUU7Z0JBQ2pCO1lBRUEyQyxJQUFJekIsTUFBTSxDQUFDLEtBQUsyQixJQUFJLENBQUM7Z0JBQ25CQyxPQUFPLGdDQUNMOEIsaUJBQWlCN0UsR0FBRyxDQUFDa0YsQ0FBQUEsSUFDbkIsQ0FBQyxFQUFFLEVBQUVBLEVBQUVKLElBQUksQ0FBQyxFQUFFLEVBQUVJLEVBQUVGLFNBQVMsQ0FBQyxJQUFJLEVBQUVFLEVBQUVqSCxhQUFhLENBQUMsQ0FBQyxFQUNuRG1CLElBQUksQ0FBQztZQUNYO1FBQ0YsT0FBTztZQUNMd0QsSUFBSXpCLE1BQU0sQ0FBQyxLQUFLMkIsSUFBSSxDQUFDO2dCQUNuQkMsT0FBTztZQUNUO1FBQ0Y7SUFDRixFQUFFLE9BQU9vQyxPQUFPO1FBQ2RDLFFBQVFELEtBQUssQ0FBQyxnQkFBZ0JBO1FBQzlCdkMsSUFBSXpCLE1BQU0sQ0FBQyxLQUFLMkIsSUFBSSxDQUFDO1lBQ25CQyxPQUFPO1FBQ1Q7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYXp1cmUtYWktaW5mcmEtYXNzaXN0YW50Ly4vcGFnZXMvYXBpL3F1ZXJ5LmpzP2M3MTUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGVmYXVsdEF6dXJlQ3JlZGVudGlhbCB9IGZyb20gXCJAYXp1cmUvaWRlbnRpdHlcIlxyXG5pbXBvcnQgeyBMb2dzUXVlcnlDbGllbnQgfSBmcm9tIFwiQGF6dXJlL21vbml0b3ItcXVlcnlcIlxyXG5pbXBvcnQgeyBDb21wdXRlTWFuYWdlbWVudENsaWVudCB9IGZyb20gXCJAYXp1cmUvYXJtLWNvbXB1dGVcIlxyXG5pbXBvcnQgeyBDb3N0TWFuYWdlbWVudENsaWVudCB9IGZyb20gXCJAYXp1cmUvYXJtLWNvc3RtYW5hZ2VtZW50XCJcclxuaW1wb3J0IHsgTW9uaXRvckNsaWVudCB9IGZyb20gXCJAYXp1cmUvYXJtLW1vbml0b3JcIlxyXG5pbXBvcnQgeyBSZXNvdXJjZU1hbmFnZW1lbnRDbGllbnQgfSBmcm9tIFwiQGF6dXJlL2FybS1yZXNvdXJjZXNcIlxyXG5pbXBvcnQgeyBXZWJTaXRlTWFuYWdlbWVudENsaWVudCB9IGZyb20gXCJAYXp1cmUvYXJtLWFwcHNlcnZpY2VcIlxyXG5cclxuY29uc3QgbW9ja0FJUmVzcG9uc2UgPSAocXVlcnkpID0+IHtcclxuICBjb25zdCBxID0gcXVlcnkudG9Mb3dlckNhc2UoKVxyXG4gIGlmIChxLmluY2x1ZGVzKCdjcHUgdXNhZ2UnKSkge1xyXG4gICAgcmV0dXJuIFwiVGhlIENQVSB1c2FnZSBvZiB5b3VyIHByb2R1Y3Rpb24gVk0gaXMgY3VycmVudGx5IGF0IDc1JVwiXHJcbiAgfSBcclxuICBpZiAocS5pbmNsdWRlcygnYWxlcnRzJykpIHtcclxuICAgIHJldHVybiBcIkhlcmUgYXJlIHRoZSBsYXN0IDUgY3JpdGljYWwgYWxlcnRzOlxcbi0gSGlnaCBNZW1vcnkgVXNhZ2UgKFZNLVBST0QxKVxcbi0gRmFpbGVkIEJhY2t1cCAoREItMDIpXFxuLSBOZXR3b3JrIFRpbWVvdXQgKEFQUC1TVkMtMylcXG4tIFNTTCBDZXJ0aWZpY2F0ZSBFeHBpcmluZyAoV0FGLTAxKVxcbi0gRGlzayBTcGFjZSBDcml0aWNhbCAoU1RPUkFHRS0wNSlcIlxyXG4gIH1cclxuICBpZiAocS5pbmNsdWRlcygnY29zdCcpKSB7XHJcbiAgICByZXR1cm4gXCJZb3VyIGN1cnJlbnQgbW9udGgncyBBenVyZSBzcGVuZGluZyBpcyAkMTIsNDUwLCB3aGljaCBpcyAxNSUgaGlnaGVyIHRoYW4gbGFzdCBtb250aFwiXHJcbiAgfVxyXG4gIHJldHVybiBcIkkgdW5kZXJzdGFuZCB5b3UncmUgYXNraW5nIGFib3V0IEF6dXJlIGluZnJhc3RydWN0dXJlLiBDb3VsZCB5b3UgYmUgbW9yZSBzcGVjaWZpYyBhYm91dCB3aGF0IHlvdSdkIGxpa2UgdG8ga25vdz9cIlxyXG59XHJcblxyXG5jb25zdCBleHRyYWN0UXVlcnkgPSAocXVlcnkpID0+IHtcclxuICBjb25zdCBxID0gcXVlcnkudG9Mb3dlckNhc2UoKVxyXG4gIFxyXG4gIGlmIChxLmluY2x1ZGVzKCdjb3N0JykgfHwgcS5pbmNsdWRlcygnc3BlbmRpbmcnKSB8fCBxLmluY2x1ZGVzKCdidWRnZXQnKSkge1xyXG4gICAgcmV0dXJuIHsgdHlwZTogJ2Nvc3QnLCBhY3Rpb246ICdvdmVydmlldycgfVxyXG4gIH1cclxuICBcclxuICBpZiAocS5pbmNsdWRlcygncGVyZm9ybWFuY2UnKSB8fCBxLmluY2x1ZGVzKCdjcHUnKSB8fCBxLmluY2x1ZGVzKCdtZW1vcnknKSkge1xyXG4gICAgcmV0dXJuIHsgdHlwZTogJ21vbml0b3InLCBhY3Rpb246ICdwZXJmb3JtYW5jZScgfVxyXG4gIH1cclxuXHJcbiAgaWYgKHEuaW5jbHVkZXMoJ2Vycm9ycycpIHx8IHEuaW5jbHVkZXMoJ2ZhaWx1cmVzJykgfHwgcS5pbmNsdWRlcygnZmFpbGVkJykpIHtcclxuICAgIHJldHVybiB7IHR5cGU6ICdtb25pdG9yJywgYWN0aW9uOiAnZXJyb3JzJyB9XHJcbiAgfVxyXG4gIFxyXG4gIGlmIChxLmluY2x1ZGVzKCdhbGVydCcpIHx8IHEuaW5jbHVkZXMoJ3dhcm5pbmcnKSkge1xyXG4gICAgcmV0dXJuIHsgdHlwZTogJ21vbml0b3InLCBhY3Rpb246ICdhbGVydHMnIH1cclxuICB9XHJcbiAgXHJcbiAgY29uc3QgcmVzdGFydE1hdGNoID0gcS5tYXRjaCgvcmVzdGFydFxccysoPzp2bVxccyspPyhbXlxcc10rKVxccysoPzppbnxmcm9tKVxccysoPzpyZXNvdXJjZSBncm91cFxccyspPyhbXlxcc10rKS9pKVxyXG4gIGlmIChyZXN0YXJ0TWF0Y2gpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHR5cGU6ICd2bScsXHJcbiAgICAgIGFjdGlvbjogJ3Jlc3RhcnQnLFxyXG4gICAgICB2bU5hbWU6IHJlc3RhcnRNYXRjaFsxXSxcclxuICAgICAgcmVzb3VyY2VHcm91cDogcmVzdGFydE1hdGNoWzJdXHJcbiAgICB9XHJcbiAgfVxyXG4gIFxyXG4gIC8vIEFwcCBTZXJ2aWNlIHNjYWxpbmdcclxuICBjb25zdCBzY2FsZU1hdGNoID0gcS5tYXRjaCgvc2NhbGVcXHMrKD86YXBwfHNlcnZpY2UpXFxzKyhbXlxcc10rKVxccysoPzp0b3xieSlcXHMrKFxcZCspL2kpXHJcbiAgaWYgKHNjYWxlTWF0Y2gpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHR5cGU6ICdhcHBzZXJ2aWNlJyxcclxuICAgICAgYWN0aW9uOiAnc2NhbGUnLFxyXG4gICAgICBhcHBOYW1lOiBzY2FsZU1hdGNoWzFdLFxyXG4gICAgICBpbnN0YW5jZXM6IHBhcnNlSW50KHNjYWxlTWF0Y2hbMl0pXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBSZXNvdXJjZSBsaXN0aW5nXHJcbiAgaWYgKHEuaW5jbHVkZXMoJ2xpc3QnKSAmJiBxLmluY2x1ZGVzKCdyZXNvdXJjZXMnKSkge1xyXG4gICAgcmV0dXJuIHsgdHlwZTogJ3Jlc291cmNlJywgYWN0aW9uOiAnbGlzdCcgfVxyXG4gIH1cclxuICBcclxuICByZXR1cm4gbnVsbFxyXG59XHJcblxyXG5jb25zdCBnZXRDb3N0T3B0aW1pemF0aW9ucyA9IChjb3N0RGF0YSkgPT4ge1xyXG4gIGNvbnN0IHN1Z2dlc3Rpb25zID0gW11cclxuICBjb25zdCB0b3RhbENvc3QgPSBjb3N0RGF0YS5yZWR1Y2UoKHN1bSwgZCkgPT4gc3VtICsgcGFyc2VGbG9hdChkLmNvc3QpLCAwKVxyXG4gIFxyXG4gIC8vIEZpbmQgZXhwZW5zaXZlIHJlc291cmNlIGdyb3VwcyAoPjIwJSBvZiB0b3RhbClcclxuICBjb3N0RGF0YS5mb3JFYWNoKGQgPT4ge1xyXG4gICAgY29uc3QgcGVyY2VudGFnZSA9IChwYXJzZUZsb2F0KGQuY29zdCkgLyB0b3RhbENvc3QpICogMTAwXHJcbiAgICBpZiAocGVyY2VudGFnZSA+IDIwKSB7XHJcbiAgICAgIHN1Z2dlc3Rpb25zLnB1c2goXHJcbiAgICAgICAgYOKaoO+4jyBSZXNvdXJjZSBncm91cCBcIiR7ZC5yZXNvdXJjZUdyb3VwfVwiIGFjY291bnRzIGZvciAke3BlcmNlbnRhZ2UudG9GaXhlZCgxKX0lIG9mIHRvdGFsIGNvc3RzLiBDb25zaWRlcjpcclxu4oCiIFJldmlld2luZyB1bnVzZWQgcmVzb3VyY2VzXHJcbuKAoiBJbXBsZW1lbnRpbmcgYXV0by1zaHV0ZG93biBmb3IgZGV2L3Rlc3QgVk1zXHJcbuKAoiBVc2luZyByZXNlcnZlZCBpbnN0YW5jZXMgZm9yIHByZWRpY3RhYmxlIHdvcmtsb2Fkc2BcclxuICAgICAgKVxyXG4gICAgfVxyXG4gIH0pXHJcblxyXG4gIC8vIEdlbmVyYWwgc3VnZ2VzdGlvbnMgaWYgY29zdHMgYXJlIGhpZ2hcclxuICBpZiAodG90YWxDb3N0ID4gMTAwMDApIHtcclxuICAgIHN1Z2dlc3Rpb25zLnB1c2goXHJcbiAgICAgIGDwn5KhIEdlbmVyYWwgY29zdCBvcHRpbWl6YXRpb24gdGlwczpcclxu4oCiIEVuYWJsZSBBenVyZSBBZHZpc29yIGZvciBjb3N0IHJlY29tbWVuZGF0aW9uc1xyXG7igKIgUmV2aWV3IGFuZCBkZWxldGUgdW51c2VkIHJlc291cmNlc1xyXG7igKIgQ29uc2lkZXIgbW92aW5nIHRvIFBhYVMgc2VydmljZXMgd2hlcmUgcG9zc2libGVcclxu4oCiIEltcGxlbWVudCByZXNvdXJjZSB0YWdnaW5nIGZvciBiZXR0ZXIgY29zdCB0cmFja2luZ2BcclxuICAgIClcclxuICB9XHJcblxyXG4gIHJldHVybiBzdWdnZXN0aW9ucy5sZW5ndGggPyAnXFxuXFxuT3B0aW1pemF0aW9uIFN1Z2dlc3Rpb25zOlxcbicgKyBzdWdnZXN0aW9ucy5qb2luKCdcXG5cXG4nKSA6ICcnXHJcbn1cclxuXHJcbmNvbnN0IGdldE1vbml0b3JpbmdEYXRhID0gYXN5bmMgKGNsaWVudCwgYWN0aW9uKSA9PiB7XHJcbiAgY29uc3QgdGltZXNwYW4gPSB7IGR1cmF0aW9uOiAnUDFEJyB9XHJcbiAgXHJcbiAgaWYgKGFjdGlvbiA9PT0gJ3BlcmZvcm1hbmNlJykge1xyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY2xpZW50LnF1ZXJ5V29ya3NwYWNlKFxyXG4gICAgICBwcm9jZXNzLmVudi5BWlVSRV9XT1JLU1BBQ0VfSUQsXHJcbiAgICAgIGBQZXJmXHJcbiAgICAgIHwgd2hlcmUgVGltZUdlbmVyYXRlZCA+IGFnbygxaClcclxuICAgICAgfCB3aGVyZSBPYmplY3ROYW1lID09IFwiUHJvY2Vzc29yXCIgb3IgT2JqZWN0TmFtZSA9PSBcIk1lbW9yeVwiXHJcbiAgICAgIHwgc3VtbWFyaXplIGF2ZyhDb3VudGVyVmFsdWUpIGJ5IE9iamVjdE5hbWUsIENvdW50ZXJOYW1lXHJcbiAgICAgIHwgb3JkZXIgYnkgT2JqZWN0TmFtZSBhc2NgLFxyXG4gICAgICB0aW1lc3BhblxyXG4gICAgKVxyXG5cclxuICAgIGlmICghcmVzdWx0LnRhYmxlcz8uWzBdPy5yb3dzPy5sZW5ndGgpIHtcclxuICAgICAgcmV0dXJuIFwiTm8gcGVyZm9ybWFuY2UgZGF0YSBhdmFpbGFibGUgZm9yIHRoZSBsYXN0IGhvdXIuXCJcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gYPCfk4ogTGFzdCBob3VyJ3MgcGVyZm9ybWFuY2UgbWV0cmljczpcXG4ke1xyXG4gICAgICByZXN1bHQudGFibGVzWzBdLnJvd3MubWFwKHJvdyA9PiBcclxuICAgICAgICBg4oCiICR7cm93WzBdfSAke3Jvd1sxXX06ICR7TWF0aC5yb3VuZChyb3dbMl0pfSVgXHJcbiAgICAgICkuam9pbignXFxuJylcclxuICAgIH1gXHJcbiAgfVxyXG5cclxuICBpZiAoYWN0aW9uID09PSAnZXJyb3JzJykge1xyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY2xpZW50LnF1ZXJ5V29ya3NwYWNlKFxyXG4gICAgICBwcm9jZXNzLmVudi5BWlVSRV9XT1JLU1BBQ0VfSUQsXHJcbiAgICAgIGBBenVyZUFjdGl2aXR5IFxyXG4gICAgICB8IHdoZXJlIFRpbWVHZW5lcmF0ZWQgPiBhZ28oMjRoKVxyXG4gICAgICB8IHdoZXJlIExldmVsID09IFwiRXJyb3JcIiBvciBTdGF0dXMgY29udGFpbnMgXCJGYWlsZWRcIlxyXG4gICAgICB8IHByb2plY3QgVGltZUdlbmVyYXRlZCwgUmVzb3VyY2VHcm91cCwgT3BlcmF0aW9uTmFtZSwgU3RhdHVzXHJcbiAgICAgIHwgdG9wIDUgYnkgVGltZUdlbmVyYXRlZCBkZXNjYCxcclxuICAgICAgdGltZXNwYW5cclxuICAgIClcclxuXHJcbiAgICBpZiAoIXJlc3VsdC50YWJsZXM/LlswXT8ucm93cz8ubGVuZ3RoKSB7XHJcbiAgICAgIHJldHVybiBcIuKchSBObyBlcnJvcnMgZm91bmQgaW4gdGhlIGxhc3QgMjQgaG91cnMhXCJcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gYOKaoO+4jyBSZWNlbnQgZXJyb3JzOlxcbiR7XHJcbiAgICAgIHJlc3VsdC50YWJsZXNbMF0ucm93cy5tYXAocm93ID0+IFxyXG4gICAgICAgIGDigKIgJHtuZXcgRGF0ZShyb3dbMF0pLnRvTG9jYWxlU3RyaW5nKCl9OiAke3Jvd1syXX0gaW4gJHtyb3dbMV19ICgke3Jvd1szXX0pYFxyXG4gICAgICApLmpvaW4oJ1xcbicpXHJcbiAgICB9YFxyXG4gIH1cclxufVxyXG5cclxuY29uc3QgZ2V0QWxlcnREYXRhID0gYXN5bmMgKGNsaWVudCkgPT4ge1xyXG4gIGNvbnN0IGFsZXJ0cyA9IGF3YWl0IGNsaWVudC5hY3Rpdml0eUxvZ0FsZXJ0cy5saXN0QnlTdWJzY3JpcHRpb25JZCgpXHJcbiAgY29uc3QgYWN0aXZlQWxlcnRzID0gW11cclxuICBcclxuICBmb3IgYXdhaXQgKGNvbnN0IGFsZXJ0IG9mIGFsZXJ0cykge1xyXG4gICAgaWYgKGFsZXJ0LmVuYWJsZWQpIHtcclxuICAgICAgYWN0aXZlQWxlcnRzLnB1c2goe1xyXG4gICAgICAgIG5hbWU6IGFsZXJ0Lm5hbWUsXHJcbiAgICAgICAgZGVzY3JpcHRpb246IGFsZXJ0LmRlc2NyaXB0aW9uLFxyXG4gICAgICAgIGNvbmRpdGlvbjogYWxlcnQuY29uZGl0aW9uPy5hbGxPZj8uWzBdPy5lcXVhbHMgfHwgJ0N1c3RvbSBjb25kaXRpb24nLFxyXG4gICAgICAgIHNldmVyaXR5OiBhbGVydC5zZXZlcml0eSB8fCAnVW5rbm93bicsXHJcbiAgICAgICAgc3RhdHVzOiBhbGVydC5zdGF0dXMgfHwgJ0FjdGl2ZSdcclxuICAgICAgfSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGlmICghYWN0aXZlQWxlcnRzLmxlbmd0aCkge1xyXG4gICAgcmV0dXJuIFwi4pyFIE5vIGFjdGl2ZSBhbGVydHMgY29uZmlndXJlZC5cIlxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGDwn5qoIEFjdGl2ZSBBbGVydCBSdWxlczpcXG4ke1xyXG4gICAgYWN0aXZlQWxlcnRzLm1hcChhbGVydCA9PiBcclxuICAgICAgYOKAoiAke2FsZXJ0Lm5hbWV9ICgke2FsZXJ0LnNldmVyaXR5fSlcXG4gICR7YWxlcnQuZGVzY3JpcHRpb24gfHwgJ05vIGRlc2NyaXB0aW9uJ31gXHJcbiAgICApLmpvaW4oJ1xcblxcbicpXHJcbiAgfWBcclxufVxyXG5cclxuY29uc3QgaGFuZGxlUmVzb3VyY2VBY3Rpb24gPSBhc3luYyAoYWN0aW9uKSA9PiB7XHJcbiAgY29uc3QgY3JlZGVudGlhbCA9IG5ldyBEZWZhdWx0QXp1cmVDcmVkZW50aWFsKClcclxuICBjb25zdCBjbGllbnQgPSBuZXcgUmVzb3VyY2VNYW5hZ2VtZW50Q2xpZW50KGNyZWRlbnRpYWwsIHByb2Nlc3MuZW52LkFaVVJFX1NVQlNDUklQVElPTl9JRClcclxuICBjb25zdCByZXNvdXJjZXMgPSBhd2FpdCBjbGllbnQucmVzb3VyY2VzLmxpc3QoKVxyXG4gIGNvbnN0IGdyb3VwZWRSZXNvdXJjZXMgPSB7fVxyXG4gIFxyXG4gIGZvciBhd2FpdCAoY29uc3QgcmVzb3VyY2Ugb2YgcmVzb3VyY2VzKSB7XHJcbiAgICBjb25zdCB0eXBlID0gcmVzb3VyY2UudHlwZS5zcGxpdCgnLycpLnBvcCgpXHJcbiAgICBpZiAoIWdyb3VwZWRSZXNvdXJjZXNbdHlwZV0pIHtcclxuICAgICAgZ3JvdXBlZFJlc291cmNlc1t0eXBlXSA9IFtdXHJcbiAgICB9XHJcbiAgICBncm91cGVkUmVzb3VyY2VzW3R5cGVdLnB1c2gocmVzb3VyY2UubmFtZSlcclxuICB9XHJcblxyXG4gIHJldHVybiBg8J+TiiBBenVyZSBSZXNvdXJjZXM6XFxuJHtcclxuICAgIE9iamVjdC5lbnRyaWVzKGdyb3VwZWRSZXNvdXJjZXMpXHJcbiAgICAgIC5tYXAoKFt0eXBlLCBuYW1lc10pID0+IFxyXG4gICAgICAgIGBcXG4ke3R5cGV9ICgke25hbWVzLmxlbmd0aH0pOlxcbiR7XHJcbiAgICAgICAgICBuYW1lcy5tYXAobmFtZSA9PiBg4oCiICR7bmFtZX1gKS5qb2luKCdcXG4nKVxyXG4gICAgICAgIH1gXHJcbiAgICAgICkuam9pbignXFxuJylcclxuICB9YFxyXG59XHJcblxyXG5jb25zdCBoYW5kbGVBcHBTZXJ2aWNlQWN0aW9uID0gYXN5bmMgKGFjdGlvbikgPT4ge1xyXG4gIGNvbnN0IGNyZWRlbnRpYWwgPSBuZXcgRGVmYXVsdEF6dXJlQ3JlZGVudGlhbCgpXHJcbiAgY29uc3QgY2xpZW50ID0gbmV3IFdlYlNpdGVNYW5hZ2VtZW50Q2xpZW50KGNyZWRlbnRpYWwsIHByb2Nlc3MuZW52LkFaVVJFX1NVQlNDUklQVElPTl9JRClcclxuICBcclxuICBpZiAoYWN0aW9uLmFjdGlvbiA9PT0gJ3NjYWxlJykge1xyXG4gICAgY29uc3Qgc2l0ZXMgPSBhd2FpdCBjbGllbnQud2ViQXBwcy5saXN0KClcclxuICAgIGNvbnN0IGFwcCA9IEFycmF5LmZyb20oc2l0ZXMpLmZpbmQocyA9PiBcclxuICAgICAgcy5uYW1lLnRvTG93ZXJDYXNlKCkgPT09IGFjdGlvbi5hcHBOYW1lLnRvTG93ZXJDYXNlKClcclxuICAgIClcclxuICAgIFxyXG4gICAgaWYgKCFhcHApIHtcclxuICAgICAgcmV0dXJuIGDinYwgQXBwIFwiJHthY3Rpb24uYXBwTmFtZX1cIiBub3QgZm91bmRgXHJcbiAgICB9XHJcblxyXG4gICAgYXdhaXQgY2xpZW50LndlYkFwcHMudXBkYXRlQ29uZmlndXJhdGlvbihcclxuICAgICAgYXBwLnJlc291cmNlR3JvdXAsXHJcbiAgICAgIGFwcC5uYW1lLFxyXG4gICAgICB7XHJcbiAgICAgICAgbnVtYmVyT2ZXb3JrZXJzOiBhY3Rpb24uaW5zdGFuY2VzXHJcbiAgICAgIH1cclxuICAgIClcclxuXHJcbiAgICByZXR1cm4gYOKchSBTY2FsZWQgJHthY3Rpb24uYXBwTmFtZX0gdG8gJHthY3Rpb24uaW5zdGFuY2VzfSBpbnN0YW5jZXNgXHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzKSB7XHJcbiAgaWYgKHJlcS5tZXRob2QgIT09ICdQT1NUJykge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA1KS5qc29uKHsgcmVwbHk6ICdNZXRob2Qgbm90IGFsbG93ZWQnIH0pXHJcbiAgfVxyXG5cclxuICBjb25zdCB7IHF1ZXJ5IH0gPSByZXEuYm9keVxyXG4gIGlmICghcXVlcnk/LnRyaW0oKSkge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgcmVwbHk6ICdRdWVyeSBpcyByZXF1aXJlZCcgfSlcclxuICB9XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBjcmVkZW50aWFsID0gbmV3IERlZmF1bHRBenVyZUNyZWRlbnRpYWwoKVxyXG4gICAgY29uc3QgYWN0aW9uID0gZXh0cmFjdFF1ZXJ5KHF1ZXJ5KVxyXG5cclxuICAgIGlmIChhY3Rpb24pIHtcclxuICAgICAgc3dpdGNoIChhY3Rpb24udHlwZSkge1xyXG4gICAgICAgIGNhc2UgJ3Jlc291cmNlJzpcclxuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IFxyXG4gICAgICAgICAgICByZXBseTogYXdhaXQgaGFuZGxlUmVzb3VyY2VBY3Rpb24oYWN0aW9uKSBcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgXHJcbiAgICAgICAgY2FzZSAnYXBwc2VydmljZSc6XHJcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyBcclxuICAgICAgICAgICAgcmVwbHk6IGF3YWl0IGhhbmRsZUFwcFNlcnZpY2VBY3Rpb24oYWN0aW9uKSBcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgICBcclxuICAgICAgICBjYXNlICdtb25pdG9yJzoge1xyXG4gICAgICAgICAgY29uc3QgbG9nc0NsaWVudCA9IG5ldyBMb2dzUXVlcnlDbGllbnQoY3JlZGVudGlhbClcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgaWYgKGFjdGlvbi5hY3Rpb24gPT09ICdhbGVydHMnKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1vbml0b3JDbGllbnQgPSBuZXcgTW9uaXRvckNsaWVudChjcmVkZW50aWFsLCBwcm9jZXNzLmVudi5BWlVSRV9TVUJTQ1JJUFRJT05fSUQpXHJcbiAgICAgICAgICAgIGNvbnN0IGFsZXJ0RGF0YSA9IGF3YWl0IGdldEFsZXJ0RGF0YShtb25pdG9yQ2xpZW50KVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyByZXBseTogYWxlcnREYXRhIH0pXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIGNvbnN0IG1vbml0b3JEYXRhID0gYXdhaXQgZ2V0TW9uaXRvcmluZ0RhdGEobG9nc0NsaWVudCwgYWN0aW9uLmFjdGlvbilcclxuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IHJlcGx5OiBtb25pdG9yRGF0YSB9KVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY2FzZSAnY29zdCc6IHtcclxuICAgICAgICAgIGNvbnN0IGNvc3RDbGllbnQgPSBuZXcgQ29zdE1hbmFnZW1lbnRDbGllbnQoY3JlZGVudGlhbCwgcHJvY2Vzcy5lbnYuQVpVUkVfU1VCU0NSSVBUSU9OX0lEKVxyXG4gICAgICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpXHJcbiAgICAgICAgICBjb25zdCBmaXJzdERheSA9IG5ldyBEYXRlKHRvZGF5LmdldEZ1bGxZZWFyKCksIHRvZGF5LmdldE1vbnRoKCksIDEpXHJcbiAgICAgICAgICBjb25zdCBsYXN0RGF5ID0gbmV3IERhdGUodG9kYXkuZ2V0RnVsbFllYXIoKSwgdG9kYXkuZ2V0TW9udGgoKSArIDEsIDApXHJcblxyXG4gICAgICAgICAgY29uc3QgY29zdFF1ZXJ5ID0ge1xyXG4gICAgICAgICAgICB0eXBlOiAnQWN0dWFsQ29zdCcsXHJcbiAgICAgICAgICAgIHRpbWVmcmFtZTogJ0N1c3RvbScsXHJcbiAgICAgICAgICAgIHRpbWVQZXJpb2Q6IHtcclxuICAgICAgICAgICAgICBmcm9tOiBmaXJzdERheS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgICAgICAgIHRvOiBsYXN0RGF5LnRvSVNPU3RyaW5nKClcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZGF0YXNldDoge1xyXG4gICAgICAgICAgICAgIGdyYW51bGFyaXR5OiAnTW9udGhseScsXHJcbiAgICAgICAgICAgICAgYWdncmVnYXRpb246IHtcclxuICAgICAgICAgICAgICAgIHRvdGFsQ29zdDogeyBuYW1lOiAnQ29zdCcsIGZ1bmN0aW9uOiAnU3VtJyB9XHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICBncm91cGluZzogW1xyXG4gICAgICAgICAgICAgICAgeyB0eXBlOiAnRGltZW5zaW9uJywgbmFtZTogJ1Jlc291cmNlR3JvdXAnIH1cclxuICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBjb25zdCBzY29wZSA9IGAvc3Vic2NyaXB0aW9ucy8ke3Byb2Nlc3MuZW52LkFaVVJFX1NVQlNDUklQVElPTl9JRH1gXHJcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb3N0Q2xpZW50LnF1ZXJ5LnVzYWdlKHNjb3BlLCBjb3N0UXVlcnkpXHJcblxyXG4gICAgICAgICAgY29uc3QgY29zdERhdGEgPSByZXN1bHQucm93cy5tYXAocm93ID0+ICh7XHJcbiAgICAgICAgICAgIHJlc291cmNlR3JvdXA6IHJvd1sxXSxcclxuICAgICAgICAgICAgY29zdDogcm93WzBdLnRvRml4ZWQoMilcclxuICAgICAgICAgIH0pKVxyXG5cclxuICAgICAgICAgIGNvbnN0IHRvdGFsID0gY29zdERhdGEucmVkdWNlKChzdW0sIGQpID0+IHN1bSArIHBhcnNlRmxvYXQoZC5jb3N0KSwgMClcclxuICAgICAgICAgIGNvbnN0IG9wdGltaXphdGlvbnMgPSBnZXRDb3N0T3B0aW1pemF0aW9ucyhjb3N0RGF0YSlcclxuXHJcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oe1xyXG4gICAgICAgICAgICByZXBseTogYPCfkrAgQ3VycmVudCBtb250aCdzIGNvc3RzOlxcbiR7XHJcbiAgICAgICAgICAgICAgY29zdERhdGEubWFwKGQgPT4gYOKAoiAke2QucmVzb3VyY2VHcm91cH06ICQke2QuY29zdH1gKS5qb2luKCdcXG4nKVxyXG4gICAgICAgICAgICB9XFxuXFxu8J+TiiBUb3RhbDogJCR7dG90YWwudG9GaXhlZCgyKX0ke29wdGltaXphdGlvbnN9YFxyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNhc2UgJ3ZtJzoge1xyXG4gICAgICAgICAgY29uc3QgY29tcHV0ZUNsaWVudCA9IG5ldyBDb21wdXRlTWFuYWdlbWVudENsaWVudChcclxuICAgICAgICAgICAgY3JlZGVudGlhbCxcclxuICAgICAgICAgICAgcHJvY2Vzcy5lbnYuQVpVUkVfU1VCU0NSSVBUSU9OX0lEXHJcbiAgICAgICAgICApXHJcblxyXG4gICAgICAgICAgYXdhaXQgY29tcHV0ZUNsaWVudC52aXJ0dWFsTWFjaGluZXMuYmVnaW5SZXN0YXJ0QW5kV2FpdChcclxuICAgICAgICAgICAgYWN0aW9uLnJlc291cmNlR3JvdXAsXHJcbiAgICAgICAgICAgIGFjdGlvbi52bU5hbWVcclxuICAgICAgICAgIClcclxuXHJcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oe1xyXG4gICAgICAgICAgICByZXBseTogYOKchSBTdWNjZXNzZnVsbHkgcmVzdGFydGVkIFZNICR7YWN0aW9uLnZtTmFtZX0gaW4gJHthY3Rpb24ucmVzb3VyY2VHcm91cH1gXHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIERlZmF1bHQgcXVlcnkgZm9yIGZhaWxlZCBhY3Rpdml0aWVzXHJcbiAgICBjb25zdCBsb2dzQ2xpZW50ID0gbmV3IExvZ3NRdWVyeUNsaWVudChjcmVkZW50aWFsKVxyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgbG9nc0NsaWVudC5xdWVyeVdvcmtzcGFjZShcclxuICAgICAgcHJvY2Vzcy5lbnYuQVpVUkVfV09SS1NQQUNFX0lELFxyXG4gICAgICBgQXp1cmVBY3Rpdml0eSBcclxuICAgICAgfCB3aGVyZSBBY3Rpdml0eVN0YXR1cyA9PSAnRmFpbGVkJyBcclxuICAgICAgfCBwcm9qZWN0IFRpbWVHZW5lcmF0ZWQsIFJlc291cmNlR3JvdXAsIFJlc291cmNlUHJvdmlkZXJWYWx1ZSwgT3BlcmF0aW9uTmFtZSwgUHJvcGVydGllc1xyXG4gICAgICB8IHRvcCA1IGJ5IFRpbWVHZW5lcmF0ZWQgZGVzY2AsXHJcbiAgICAgIHsgZHVyYXRpb246IFwiUDFEXCIgfVxyXG4gICAgKVxyXG5cclxuICAgIGlmIChyZXN1bHQudGFibGVzPy5bMF0/LnJvd3M/Lmxlbmd0aCA+IDApIHtcclxuICAgICAgY29uc3QgZm9ybWF0dGVkUmVzdWx0cyA9IHJlc3VsdC50YWJsZXNbMF0ucm93cy5tYXAocm93ID0+ICh7XHJcbiAgICAgICAgdGltZTogbmV3IERhdGUocm93WzBdKS50b0xvY2FsZVN0cmluZygpLFxyXG4gICAgICAgIHJlc291cmNlR3JvdXA6IHJvd1sxXSxcclxuICAgICAgICBwcm92aWRlcjogcm93WzJdLFxyXG4gICAgICAgIG9wZXJhdGlvbjogcm93WzNdLFxyXG4gICAgICAgIGRldGFpbHM6IHJvd1s0XVxyXG4gICAgICB9KSlcclxuXHJcbiAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgXHJcbiAgICAgICAgcmVwbHk6IFwiUmVjZW50IGZhaWxlZCBhY3Rpdml0aWVzOlxcblwiICsgXHJcbiAgICAgICAgICBmb3JtYXR0ZWRSZXN1bHRzLm1hcChyID0+IFxyXG4gICAgICAgICAgICBg4oCiICR7ci50aW1lfTogJHtyLm9wZXJhdGlvbn0gaW4gJHtyLnJlc291cmNlR3JvdXB9YFxyXG4gICAgICAgICAgKS5qb2luKFwiXFxuXCIpXHJcbiAgICAgIH0pXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7IFxyXG4gICAgICAgIHJlcGx5OiBcIkdvb2QgbmV3cyEgTm8gZmFpbGVkIGFjdGl2aXRpZXMgZm91bmQgaW4gdGhlIGxhc3QgMjQgaG91cnMuXCIgXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJBenVyZSBFcnJvcjpcIiwgZXJyb3IpXHJcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IFxyXG4gICAgICByZXBseTogXCJTb3JyeSwgSSBlbmNvdW50ZXJlZCBhbiBlcnJvciB3aGlsZSBwcm9jZXNzaW5nIHlvdXIgcmVxdWVzdC4gUGxlYXNlIHRyeSBhZ2Fpbi5cIiBcclxuICAgIH0pXHJcbiAgfVxyXG59ICJdLCJuYW1lcyI6WyJEZWZhdWx0QXp1cmVDcmVkZW50aWFsIiwiTG9nc1F1ZXJ5Q2xpZW50IiwiQ29tcHV0ZU1hbmFnZW1lbnRDbGllbnQiLCJDb3N0TWFuYWdlbWVudENsaWVudCIsIk1vbml0b3JDbGllbnQiLCJSZXNvdXJjZU1hbmFnZW1lbnRDbGllbnQiLCJXZWJTaXRlTWFuYWdlbWVudENsaWVudCIsIm1vY2tBSVJlc3BvbnNlIiwicXVlcnkiLCJxIiwidG9Mb3dlckNhc2UiLCJpbmNsdWRlcyIsImV4dHJhY3RRdWVyeSIsInR5cGUiLCJhY3Rpb24iLCJyZXN0YXJ0TWF0Y2giLCJtYXRjaCIsInZtTmFtZSIsInJlc291cmNlR3JvdXAiLCJzY2FsZU1hdGNoIiwiYXBwTmFtZSIsImluc3RhbmNlcyIsInBhcnNlSW50IiwiZ2V0Q29zdE9wdGltaXphdGlvbnMiLCJjb3N0RGF0YSIsInN1Z2dlc3Rpb25zIiwidG90YWxDb3N0IiwicmVkdWNlIiwic3VtIiwiZCIsInBhcnNlRmxvYXQiLCJjb3N0IiwiZm9yRWFjaCIsInBlcmNlbnRhZ2UiLCJwdXNoIiwidG9GaXhlZCIsImxlbmd0aCIsImpvaW4iLCJnZXRNb25pdG9yaW5nRGF0YSIsImNsaWVudCIsInRpbWVzcGFuIiwiZHVyYXRpb24iLCJyZXN1bHQiLCJxdWVyeVdvcmtzcGFjZSIsInByb2Nlc3MiLCJlbnYiLCJBWlVSRV9XT1JLU1BBQ0VfSUQiLCJ0YWJsZXMiLCJyb3dzIiwibWFwIiwicm93IiwiTWF0aCIsInJvdW5kIiwiRGF0ZSIsInRvTG9jYWxlU3RyaW5nIiwiZ2V0QWxlcnREYXRhIiwiYWxlcnRzIiwiYWN0aXZpdHlMb2dBbGVydHMiLCJsaXN0QnlTdWJzY3JpcHRpb25JZCIsImFjdGl2ZUFsZXJ0cyIsImFsZXJ0IiwiZW5hYmxlZCIsIm5hbWUiLCJkZXNjcmlwdGlvbiIsImNvbmRpdGlvbiIsImFsbE9mIiwiZXF1YWxzIiwic2V2ZXJpdHkiLCJzdGF0dXMiLCJoYW5kbGVSZXNvdXJjZUFjdGlvbiIsImNyZWRlbnRpYWwiLCJBWlVSRV9TVUJTQ1JJUFRJT05fSUQiLCJyZXNvdXJjZXMiLCJsaXN0IiwiZ3JvdXBlZFJlc291cmNlcyIsInJlc291cmNlIiwic3BsaXQiLCJwb3AiLCJPYmplY3QiLCJlbnRyaWVzIiwibmFtZXMiLCJoYW5kbGVBcHBTZXJ2aWNlQWN0aW9uIiwic2l0ZXMiLCJ3ZWJBcHBzIiwiYXBwIiwiQXJyYXkiLCJmcm9tIiwiZmluZCIsInMiLCJ1cGRhdGVDb25maWd1cmF0aW9uIiwibnVtYmVyT2ZXb3JrZXJzIiwiaGFuZGxlciIsInJlcSIsInJlcyIsIm1ldGhvZCIsImpzb24iLCJyZXBseSIsImJvZHkiLCJ0cmltIiwibG9nc0NsaWVudCIsIm1vbml0b3JDbGllbnQiLCJhbGVydERhdGEiLCJtb25pdG9yRGF0YSIsImNvc3RDbGllbnQiLCJ0b2RheSIsImZpcnN0RGF5IiwiZ2V0RnVsbFllYXIiLCJnZXRNb250aCIsImxhc3REYXkiLCJjb3N0UXVlcnkiLCJ0aW1lZnJhbWUiLCJ0aW1lUGVyaW9kIiwidG9JU09TdHJpbmciLCJ0byIsImRhdGFzZXQiLCJncmFudWxhcml0eSIsImFnZ3JlZ2F0aW9uIiwiZnVuY3Rpb24iLCJncm91cGluZyIsInNjb3BlIiwidXNhZ2UiLCJ0b3RhbCIsIm9wdGltaXphdGlvbnMiLCJjb21wdXRlQ2xpZW50IiwidmlydHVhbE1hY2hpbmVzIiwiYmVnaW5SZXN0YXJ0QW5kV2FpdCIsImZvcm1hdHRlZFJlc3VsdHMiLCJ0aW1lIiwicHJvdmlkZXIiLCJvcGVyYXRpb24iLCJkZXRhaWxzIiwiciIsImVycm9yIiwiY29uc29sZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/query.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fquery&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cquery.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();